{"version":3,"sources":["@wordpress/rich-text/src/component/use-selection-change-compat.js"],"names":["useRefEffect","useSelectionChangeCompat","element","ownerDocument","defaultView","selection","getSelection","range","getRange","rangeCount","getRangeAt","onDown","event","type","onCancel","removeEventListener","onUp","dispatchEvent","Event","addEventListener"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,YAAT,QAA6B,oBAA7B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASC,wBAAT,GAAoC;AAC1C,SAAOD,YAAY,CAAIE,OAAF,IAAe;AACnC,UAAM;AAAEC,MAAAA;AAAF,QAAoBD,OAA1B;AACA,UAAM;AAAEE,MAAAA;AAAF,QAAkBD,aAAxB;AACA,UAAME,SAAS,GAAGD,WAAW,CAACE,YAAZ,EAAlB;AAEA,QAAIC,KAAJ;;AAEA,aAASC,QAAT,GAAoB;AACnB,aAAOH,SAAS,CAACI,UAAV,GAAuBJ,SAAS,CAACK,UAAV,CAAsB,CAAtB,CAAvB,GAAmD,IAA1D;AACA;;AAED,aAASC,MAAT,CAAiBC,KAAjB,EAAyB;AACxB,YAAMC,IAAI,GAAGD,KAAK,CAACC,IAAN,KAAe,SAAf,GAA2B,OAA3B,GAAqC,WAAlD;;AAEA,eAASC,QAAT,GAAoB;AACnBX,QAAAA,aAAa,CAACY,mBAAd,CAAmCF,IAAnC,EAAyCG,IAAzC;AACAb,QAAAA,aAAa,CAACY,mBAAd,CACC,iBADD,EAECD,QAFD;AAIAX,QAAAA,aAAa,CAACY,mBAAd,CAAmC,OAAnC,EAA4CD,QAA5C;AACA;;AAED,eAASE,IAAT,GAAgB;AACfF,QAAAA,QAAQ;AACR,YAAKP,KAAK,KAAKC,QAAQ,EAAvB,EAA4B;AAC5BL,QAAAA,aAAa,CAACc,aAAd,CAA6B,IAAIC,KAAJ,CAAW,iBAAX,CAA7B;AACA;;AAEDf,MAAAA,aAAa,CAACgB,gBAAd,CAAgCN,IAAhC,EAAsCG,IAAtC;AACAb,MAAAA,aAAa,CAACgB,gBAAd,CAAgC,iBAAhC,EAAmDL,QAAnD;AACAX,MAAAA,aAAa,CAACgB,gBAAd,CAAgC,OAAhC,EAAyCL,QAAzC;AAEAP,MAAAA,KAAK,GAAGC,QAAQ,EAAhB;AACA;;AAEDN,IAAAA,OAAO,CAACiB,gBAAR,CAA0B,aAA1B,EAAyCR,MAAzC;AACAT,IAAAA,OAAO,CAACiB,gBAAR,CAA0B,SAA1B,EAAqCR,MAArC;AACA,WAAO,MAAM;AACZT,MAAAA,OAAO,CAACa,mBAAR,CAA6B,aAA7B,EAA4CJ,MAA5C;AACAT,MAAAA,OAAO,CAACa,mBAAR,CAA6B,SAA7B,EAAwCJ,MAAxC;AACA,KAHD;AAIA,GA1CkB,EA0ChB,EA1CgB,CAAnB;AA2CA","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRefEffect } from '@wordpress/compose';\n\n/**\n * Sometimes some browsers are not firing a `selectionchange` event when\n * changing the selection by mouse or keyboard. This hook makes sure that, if we\n * detect no `selectionchange` or `input` event between the up and down events,\n * we fire a `selectionchange` event.\n *\n * @return {import('@wordpress/compose').RefEffect} A ref effect attaching the\n *                                                  listeners.\n */\nexport function useSelectionChangeCompat() {\n\treturn useRefEffect( ( element ) => {\n\t\tconst { ownerDocument } = element;\n\t\tconst { defaultView } = ownerDocument;\n\t\tconst selection = defaultView.getSelection();\n\n\t\tlet range;\n\n\t\tfunction getRange() {\n\t\t\treturn selection.rangeCount ? selection.getRangeAt( 0 ) : null;\n\t\t}\n\n\t\tfunction onDown( event ) {\n\t\t\tconst type = event.type === 'keydown' ? 'keyup' : 'pointerup';\n\n\t\t\tfunction onCancel() {\n\t\t\t\townerDocument.removeEventListener( type, onUp );\n\t\t\t\townerDocument.removeEventListener(\n\t\t\t\t\t'selectionchange',\n\t\t\t\t\tonCancel\n\t\t\t\t);\n\t\t\t\townerDocument.removeEventListener( 'input', onCancel );\n\t\t\t}\n\n\t\t\tfunction onUp() {\n\t\t\t\tonCancel();\n\t\t\t\tif ( range === getRange() ) return;\n\t\t\t\townerDocument.dispatchEvent( new Event( 'selectionchange' ) );\n\t\t\t}\n\n\t\t\townerDocument.addEventListener( type, onUp );\n\t\t\townerDocument.addEventListener( 'selectionchange', onCancel );\n\t\t\townerDocument.addEventListener( 'input', onCancel );\n\n\t\t\trange = getRange();\n\t\t}\n\n\t\telement.addEventListener( 'pointerdown', onDown );\n\t\telement.addEventListener( 'keydown', onDown );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'pointerdown', onDown );\n\t\t\telement.removeEventListener( 'keydown', onDown );\n\t\t};\n\t}, [] );\n}\n"]}