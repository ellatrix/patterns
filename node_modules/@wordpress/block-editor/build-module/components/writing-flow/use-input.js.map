{"version":3,"sources":["@wordpress/block-editor/src/components/writing-flow/use-input.js"],"names":["useSelect","useDispatch","useRefEffect","ENTER","BACKSPACE","DELETE","createBlock","getDefaultBlockName","store","blockEditorStore","useInput","__unstableIsFullySelected","getSelectedBlockClientIds","__unstableIsSelectionMergeable","hasMultiSelection","replaceBlocks","__unstableSplitSelection","removeBlocks","__unstableDeleteSelection","__unstableExpandSelection","node","onBeforeInput","event","inputType","startsWith","preventDefault","onKeyDown","defaultPrevented","keyCode","contentEditable","key","length","metaKey","ctrlKey","ownerDocument","defaultView","getSelection","removeAllRanges","onCompositionStart","addEventListener","removeEventListener"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { useRefEffect } from '@wordpress/compose';\nimport { ENTER, BACKSPACE, DELETE } from '@wordpress/keycodes';\nimport { createBlock, getDefaultBlockName } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../store';\n\n/**\n * Handles input for selections across blocks.\n */\nexport default function useInput() {\n\tconst {\n\t\t__unstableIsFullySelected,\n\t\tgetSelectedBlockClientIds,\n\t\t__unstableIsSelectionMergeable,\n\t\thasMultiSelection,\n\t} = useSelect( blockEditorStore );\n\tconst {\n\t\treplaceBlocks,\n\t\t__unstableSplitSelection,\n\t\tremoveBlocks,\n\t\t__unstableDeleteSelection,\n\t\t__unstableExpandSelection,\n\t} = useDispatch( blockEditorStore );\n\n\treturn useRefEffect( ( node ) => {\n\t\tfunction onBeforeInput( event ) {\n\t\t\tif ( ! hasMultiSelection() ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Prevent the browser to format something when we have multiselection.\n\t\t\tif ( event.inputType?.startsWith( 'format' ) ) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\n\t\tfunction onKeyDown( event ) {\n\t\t\tif ( event.defaultPrevented ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( ! hasMultiSelection() ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( event.keyCode === ENTER ) {\n\t\t\t\tnode.contentEditable = false;\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif ( __unstableIsFullySelected() ) {\n\t\t\t\t\treplaceBlocks(\n\t\t\t\t\t\tgetSelectedBlockClientIds(),\n\t\t\t\t\t\tcreateBlock( getDefaultBlockName() )\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\t__unstableSplitSelection();\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\tevent.keyCode === BACKSPACE ||\n\t\t\t\tevent.keyCode === DELETE\n\t\t\t) {\n\t\t\t\tnode.contentEditable = false;\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif ( __unstableIsFullySelected() ) {\n\t\t\t\t\tremoveBlocks( getSelectedBlockClientIds() );\n\t\t\t\t} else if ( __unstableIsSelectionMergeable() ) {\n\t\t\t\t\t__unstableDeleteSelection( event.keyCode === DELETE );\n\t\t\t\t} else {\n\t\t\t\t\t__unstableExpandSelection();\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\t// If key.length is longer than 1, it's a control key that doesn't\n\t\t\t\t// input anything.\n\t\t\t\tevent.key.length === 1 &&\n\t\t\t\t! ( event.metaKey || event.ctrlKey )\n\t\t\t) {\n\t\t\t\tnode.contentEditable = false;\n\t\t\t\tif ( __unstableIsSelectionMergeable() ) {\n\t\t\t\t\t__unstableDeleteSelection( event.keyCode === DELETE );\n\t\t\t\t} else {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t// Safari does not stop default behaviour with either\n\t\t\t\t\t// event.preventDefault() or node.contentEditable = false, so\n\t\t\t\t\t// remove the selection to stop browser manipulation.\n\t\t\t\t\tnode.ownerDocument.defaultView\n\t\t\t\t\t\t.getSelection()\n\t\t\t\t\t\t.removeAllRanges();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction onCompositionStart( event ) {\n\t\t\tif ( ! hasMultiSelection() ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnode.contentEditable = false;\n\n\t\t\tif ( __unstableIsSelectionMergeable() ) {\n\t\t\t\t__unstableDeleteSelection();\n\t\t\t} else {\n\t\t\t\tevent.preventDefault();\n\t\t\t\t// Safari does not stop default behaviour with either\n\t\t\t\t// event.preventDefault() or node.contentEditable = false, so\n\t\t\t\t// remove the selection to stop browser manipulation.\n\t\t\t\tnode.ownerDocument.defaultView.getSelection().removeAllRanges();\n\t\t\t}\n\t\t}\n\n\t\tnode.addEventListener( 'beforeinput', onBeforeInput );\n\t\tnode.addEventListener( 'keydown', onKeyDown );\n\t\tnode.addEventListener( 'compositionstart', onCompositionStart );\n\t\treturn () => {\n\t\t\tnode.removeEventListener( 'beforeinput', onBeforeInput );\n\t\t\tnode.removeEventListener( 'keydown', onKeyDown );\n\t\t\tnode.removeEventListener( 'compositionstart', onCompositionStart );\n\t\t};\n\t}, [] );\n}\n"]}