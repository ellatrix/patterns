{"version":3,"sources":["@wordpress/block-editor/src/components/global-styles/use-global-styles-output.js"],"names":["get","isEmpty","kebabCase","set","__EXPERIMENTAL_STYLE_PROPERTY","STYLE_PROPERTY","__EXPERIMENTAL_ELEMENTS","ELEMENTS","getBlockTypes","store","blocksStore","useSelect","useContext","useMemo","getCSSRules","PRESET_METADATA","ROOT_BLOCK_SELECTOR","scopeSelector","getTypographyFontSizeValue","GlobalStylesContext","useGlobalSetting","PresetDuotoneFilter","getGapCSSValue","blockEditorStore","BLOCK_SUPPORT_FEATURE_LEVEL_SELECTORS","__experimentalBorder","color","spacing","typography","compileStyleValue","uncompiledValue","VARIABLE_REFERENCE_PREFIX","VARIABLE_PATH_SEPARATOR_TOKEN_ATTRIBUTE","VARIABLE_PATH_SEPARATOR_TOKEN_STYLE","startsWith","variable","slice","length","split","join","getPresetsDeclarations","blockPresets","mergedSettings","reduce","declarations","path","valueKey","valueFunc","cssVarInfix","presetByOrigin","forEach","origin","value","push","slug","getPresetsClasses","blockSelector","classes","classSuffix","propertyName","classSelectorToUse","selectorToUse","map","selector","getPresetsSvgFilters","filter","metadata","at","flatMap","preset","flattenTree","input","prefix","token","result","Object","keys","key","newKey","replace","newLeaf","newPrefix","concatFeatureVariationSelectorString","featureSelector","styleVariationSelector","featureSelectors","combinedSelectors","trim","getStylesDeclarations","blockStyles","useRootPaddingAlign","tree","isRoot","output","entries","properties","useEngine","rootOnly","pathToValue","styleValue","entry","name","prop","cssProperty","extraRules","rule","ruleValue","ref","refPath","size","settings","getLayoutStyles","style","hasBlockGapSupport","hasFallbackGapSupport","fallbackGapValue","ruleset","gapValue","blockGap","layout","definitions","values","className","spacingStyles","spacingStyle","rules","cssValue","combinedSelector","validDisplayModes","displayMode","baseStyles","includes","baseStyle","getNodesWithStyles","blockSelectors","nodes","styles","pickStyleKeys","treeToPickFrom","fromEntries","elements","blocks","blockName","node","variations","variation","duotoneSelector","hasLayoutSupport","styleVariationSelectors","elementName","sel","elementSelectors","elementSelector","getNodesWithSettings","pickPresets","presets","custom","blockCustom","toCustomProperties","customProps","toStyles","disableLayoutStyles","nodesWithStyles","nodesWithSettings","useRootPaddingAwareAlignments","contentSize","wideSize","featureName","featureStyles","featureDeclarations","styleVariationName","styleVariationDeclarations","duotoneStyles","duotoneDeclarations","pseudoSelectorStyles","pseudoKey","pseudoStyle","pseudoDeclarations","_selector","pseudoRule","toSvgFilters","getBlockSelectors","blockTypes","getBlockStyles","blockType","supports","__experimentalSelector","__experimentalDuotone","__experimentalLayout","__experimentalDefault","blockStyleVariations","featureKey","undefined","updateConfigWithSeparator","config","needsSeparatorStyleUpdate","background","text","border","processCSSNesting","css","processedCSS","parts","part","useGlobalStylesOutput","merged","mergedConfig","select","getSettings","customProperties","globalStyles","filters","stylesheets","isGlobalStyles"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { get, isEmpty, kebabCase, set } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport {\n\t__EXPERIMENTAL_STYLE_PROPERTY as STYLE_PROPERTY,\n\t__EXPERIMENTAL_ELEMENTS as ELEMENTS,\n\tgetBlockTypes,\n\tstore as blocksStore,\n} from '@wordpress/blocks';\nimport { useSelect } from '@wordpress/data';\nimport { useContext, useMemo } from '@wordpress/element';\nimport { getCSSRules } from '@wordpress/style-engine';\n\n/**\n * Internal dependencies\n */\nimport { PRESET_METADATA, ROOT_BLOCK_SELECTOR, scopeSelector } from './utils';\nimport { getTypographyFontSizeValue } from './typography-utils';\nimport { GlobalStylesContext } from './context';\nimport { useGlobalSetting } from './hooks';\nimport { PresetDuotoneFilter } from '../duotone/components';\nimport { getGapCSSValue } from '../../hooks/gap';\nimport { store as blockEditorStore } from '../../store';\n\n// List of block support features that can have their related styles\n// generated under their own feature level selector rather than the block's.\nconst BLOCK_SUPPORT_FEATURE_LEVEL_SELECTORS = {\n\t__experimentalBorder: 'border',\n\tcolor: 'color',\n\tspacing: 'spacing',\n\ttypography: 'typography',\n};\n\nfunction compileStyleValue( uncompiledValue ) {\n\tconst VARIABLE_REFERENCE_PREFIX = 'var:';\n\tconst VARIABLE_PATH_SEPARATOR_TOKEN_ATTRIBUTE = '|';\n\tconst VARIABLE_PATH_SEPARATOR_TOKEN_STYLE = '--';\n\n\tif ( uncompiledValue?.startsWith?.( VARIABLE_REFERENCE_PREFIX ) ) {\n\t\tconst variable = uncompiledValue\n\t\t\t.slice( VARIABLE_REFERENCE_PREFIX.length )\n\t\t\t.split( VARIABLE_PATH_SEPARATOR_TOKEN_ATTRIBUTE )\n\t\t\t.join( VARIABLE_PATH_SEPARATOR_TOKEN_STYLE );\n\t\treturn `var(--wp--${ variable })`;\n\t}\n\treturn uncompiledValue;\n}\n\n/**\n * Transform given preset tree into a set of style declarations.\n *\n * @param {Object} blockPresets\n * @param {Object} mergedSettings Merged theme.json settings.\n *\n * @return {Array<Object>} An array of style declarations.\n */\nfunction getPresetsDeclarations( blockPresets = {}, mergedSettings ) {\n\treturn PRESET_METADATA.reduce(\n\t\t( declarations, { path, valueKey, valueFunc, cssVarInfix } ) => {\n\t\t\tconst presetByOrigin = get( blockPresets, path, [] );\n\t\t\t[ 'default', 'theme', 'custom' ].forEach( ( origin ) => {\n\t\t\t\tif ( presetByOrigin[ origin ] ) {\n\t\t\t\t\tpresetByOrigin[ origin ].forEach( ( value ) => {\n\t\t\t\t\t\tif ( valueKey && ! valueFunc ) {\n\t\t\t\t\t\t\tdeclarations.push(\n\t\t\t\t\t\t\t\t`--wp--preset--${ cssVarInfix }--${ kebabCase(\n\t\t\t\t\t\t\t\t\tvalue.slug\n\t\t\t\t\t\t\t\t) }: ${ value[ valueKey ] }`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\tvalueFunc &&\n\t\t\t\t\t\t\ttypeof valueFunc === 'function'\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tdeclarations.push(\n\t\t\t\t\t\t\t\t`--wp--preset--${ cssVarInfix }--${ kebabCase(\n\t\t\t\t\t\t\t\t\tvalue.slug\n\t\t\t\t\t\t\t\t) }: ${ valueFunc( value, mergedSettings ) }`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\treturn declarations;\n\t\t},\n\t\t[]\n\t);\n}\n\n/**\n * Transform given preset tree into a set of preset class declarations.\n *\n * @param {string} blockSelector\n * @param {Object} blockPresets\n * @return {string} CSS declarations for the preset classes.\n */\nfunction getPresetsClasses( blockSelector, blockPresets = {} ) {\n\treturn PRESET_METADATA.reduce(\n\t\t( declarations, { path, cssVarInfix, classes } ) => {\n\t\t\tif ( ! classes ) {\n\t\t\t\treturn declarations;\n\t\t\t}\n\n\t\t\tconst presetByOrigin = get( blockPresets, path, [] );\n\t\t\t[ 'default', 'theme', 'custom' ].forEach( ( origin ) => {\n\t\t\t\tif ( presetByOrigin[ origin ] ) {\n\t\t\t\t\tpresetByOrigin[ origin ].forEach( ( { slug } ) => {\n\t\t\t\t\t\tclasses.forEach( ( { classSuffix, propertyName } ) => {\n\t\t\t\t\t\t\tconst classSelectorToUse = `.has-${ kebabCase(\n\t\t\t\t\t\t\t\tslug\n\t\t\t\t\t\t\t) }-${ classSuffix }`;\n\t\t\t\t\t\t\tconst selectorToUse = blockSelector\n\t\t\t\t\t\t\t\t.split( ',' ) // Selector can be \"h1, h2, h3\"\n\t\t\t\t\t\t\t\t.map(\n\t\t\t\t\t\t\t\t\t( selector ) =>\n\t\t\t\t\t\t\t\t\t\t`${ selector }${ classSelectorToUse }`\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.join( ',' );\n\t\t\t\t\t\t\tconst value = `var(--wp--preset--${ cssVarInfix }--${ kebabCase(\n\t\t\t\t\t\t\t\tslug\n\t\t\t\t\t\t\t) })`;\n\t\t\t\t\t\t\tdeclarations += `${ selectorToUse }{${ propertyName }: ${ value } !important;}`;\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\t\t\treturn declarations;\n\t\t},\n\t\t''\n\t);\n}\n\nfunction getPresetsSvgFilters( blockPresets = {} ) {\n\treturn PRESET_METADATA.filter(\n\t\t// Duotone are the only type of filters for now.\n\t\t( metadata ) => metadata.path.at( -1 ) === 'duotone'\n\t).flatMap( ( metadata ) => {\n\t\tconst presetByOrigin = get( blockPresets, metadata.path, {} );\n\t\treturn [ 'default', 'theme' ]\n\t\t\t.filter( ( origin ) => presetByOrigin[ origin ] )\n\t\t\t.flatMap( ( origin ) =>\n\t\t\t\tpresetByOrigin[ origin ].map( ( preset ) => (\n\t\t\t\t\t<PresetDuotoneFilter\n\t\t\t\t\t\tpreset={ preset }\n\t\t\t\t\t\tkey={ preset.slug }\n\t\t\t\t\t/>\n\t\t\t\t) )\n\t\t\t);\n\t} );\n}\n\nfunction flattenTree( input = {}, prefix, token ) {\n\tlet result = [];\n\tObject.keys( input ).forEach( ( key ) => {\n\t\tconst newKey = prefix + kebabCase( key.replace( '/', '-' ) );\n\t\tconst newLeaf = input[ key ];\n\n\t\tif ( newLeaf instanceof Object ) {\n\t\t\tconst newPrefix = newKey + token;\n\t\t\tresult = [ ...result, ...flattenTree( newLeaf, newPrefix, token ) ];\n\t\t} else {\n\t\t\tresult.push( `${ newKey }: ${ newLeaf }` );\n\t\t}\n\t} );\n\treturn result;\n}\n\n/**\n * Gets variation selector string from feature selector.\n *\n * @param {string} featureSelector        The feature selector.\n *\n * @param {string} styleVariationSelector The style variation selector.\n * @return {string} Combined selector string.\n *\n */\nfunction concatFeatureVariationSelectorString(\n\tfeatureSelector,\n\tstyleVariationSelector\n) {\n\tconst featureSelectors = featureSelector.split( ',' );\n\tconst combinedSelectors = [];\n\tfeatureSelectors.forEach( ( selector ) => {\n\t\tcombinedSelectors.push(\n\t\t\t`${ styleVariationSelector.trim() }${ selector.trim() }`\n\t\t);\n\t} );\n\treturn combinedSelectors.join( ', ' );\n}\n\n/**\n * Transform given style tree into a set of style declarations.\n *\n * @param {Object}  blockStyles         Block styles.\n *\n * @param {string}  selector            The selector these declarations should attach to.\n *\n * @param {boolean} useRootPaddingAlign Whether to use CSS custom properties in root selector.\n *\n * @param {Object}  tree                A theme.json tree containing layout definitions.\n *\n * @return {Array} An array of style declarations.\n */\nexport function getStylesDeclarations(\n\tblockStyles = {},\n\tselector = '',\n\tuseRootPaddingAlign,\n\ttree = {}\n) {\n\tconst isRoot = ROOT_BLOCK_SELECTOR === selector;\n\tconst output = Object.entries( STYLE_PROPERTY ).reduce(\n\t\t(\n\t\t\tdeclarations,\n\t\t\t[ key, { value, properties, useEngine, rootOnly } ]\n\t\t) => {\n\t\t\tif ( rootOnly && ! isRoot ) {\n\t\t\t\treturn declarations;\n\t\t\t}\n\t\t\tconst pathToValue = value;\n\t\t\tif ( pathToValue[ 0 ] === 'elements' || useEngine ) {\n\t\t\t\treturn declarations;\n\t\t\t}\n\n\t\t\tconst styleValue = get( blockStyles, pathToValue );\n\n\t\t\t// Root-level padding styles don't currently support strings with CSS shorthand values.\n\t\t\t// This may change: https://github.com/WordPress/gutenberg/issues/40132.\n\t\t\tif (\n\t\t\t\tkey === '--wp--style--root--padding' &&\n\t\t\t\t( typeof styleValue === 'string' || ! useRootPaddingAlign )\n\t\t\t) {\n\t\t\t\treturn declarations;\n\t\t\t}\n\n\t\t\tif ( !! properties && typeof styleValue !== 'string' ) {\n\t\t\t\tObject.entries( properties ).forEach( ( entry ) => {\n\t\t\t\t\tconst [ name, prop ] = entry;\n\n\t\t\t\t\tif ( ! get( styleValue, [ prop ], false ) ) {\n\t\t\t\t\t\t// Do not create a declaration\n\t\t\t\t\t\t// for sub-properties that don't have any value.\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst cssProperty = name.startsWith( '--' )\n\t\t\t\t\t\t? name\n\t\t\t\t\t\t: kebabCase( name );\n\t\t\t\t\tdeclarations.push(\n\t\t\t\t\t\t`${ cssProperty }: ${ compileStyleValue(\n\t\t\t\t\t\t\tget( styleValue, [ prop ] )\n\t\t\t\t\t\t) }`\n\t\t\t\t\t);\n\t\t\t\t} );\n\t\t\t} else if ( get( blockStyles, pathToValue, false ) ) {\n\t\t\t\tconst cssProperty = key.startsWith( '--' )\n\t\t\t\t\t? key\n\t\t\t\t\t: kebabCase( key );\n\t\t\t\tdeclarations.push(\n\t\t\t\t\t`${ cssProperty }: ${ compileStyleValue(\n\t\t\t\t\t\tget( blockStyles, pathToValue )\n\t\t\t\t\t) }`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn declarations;\n\t\t},\n\t\t[]\n\t);\n\n\t// The goal is to move everything to server side generated engine styles\n\t// This is temporary as we absorb more and more styles into the engine.\n\tconst extraRules = getCSSRules( blockStyles );\n\textraRules.forEach( ( rule ) => {\n\t\t// Don't output padding properties if padding variables are set.\n\t\tif (\n\t\t\tisRoot &&\n\t\t\tuseRootPaddingAlign &&\n\t\t\trule.key.startsWith( 'padding' )\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tconst cssProperty = rule.key.startsWith( '--' )\n\t\t\t? rule.key\n\t\t\t: kebabCase( rule.key );\n\n\t\tlet ruleValue = rule.value;\n\t\tif ( typeof ruleValue !== 'string' && ruleValue?.ref ) {\n\t\t\tconst refPath = ruleValue.ref.split( '.' );\n\t\t\truleValue = get( tree, refPath );\n\t\t\t// Presence of another ref indicates a reference to another dynamic value.\n\t\t\t// Pointing to another dynamic value is not supported.\n\t\t\tif ( ! ruleValue || !! ruleValue?.ref ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Calculate fluid typography rules where available.\n\t\tif ( cssProperty === 'font-size' ) {\n\t\t\t/*\n\t\t\t * getTypographyFontSizeValue() will check\n\t\t\t * if fluid typography has been activated and also\n\t\t\t * whether the incoming value can be converted to a fluid value.\n\t\t\t * Values that already have a \"clamp()\" function will not pass the test,\n\t\t\t * and therefore the original $value will be returned.\n\t\t\t */\n\t\t\truleValue = getTypographyFontSizeValue(\n\t\t\t\t{ size: ruleValue },\n\t\t\t\ttree?.settings?.typography\n\t\t\t);\n\t\t}\n\n\t\toutput.push( `${ cssProperty }: ${ ruleValue }` );\n\t} );\n\n\treturn output;\n}\n\n/**\n * Get generated CSS for layout styles by looking up layout definitions provided\n * in theme.json, and outputting common layout styles, and specific blockGap values.\n *\n * @param {Object}  props\n * @param {Object}  props.tree                  A theme.json tree containing layout definitions.\n * @param {Object}  props.style                 A style object containing spacing values.\n * @param {string}  props.selector              Selector used to group together layout styling rules.\n * @param {boolean} props.hasBlockGapSupport    Whether or not the theme opts-in to blockGap support.\n * @param {boolean} props.hasFallbackGapSupport Whether or not the theme allows fallback gap styles.\n * @param {?string} props.fallbackGapValue      An optional fallback gap value if no real gap value is available.\n * @return {string} Generated CSS rules for the layout styles.\n */\nexport function getLayoutStyles( {\n\ttree,\n\tstyle,\n\tselector,\n\thasBlockGapSupport,\n\thasFallbackGapSupport,\n\tfallbackGapValue,\n} ) {\n\tlet ruleset = '';\n\tlet gapValue = hasBlockGapSupport\n\t\t? getGapCSSValue( style?.spacing?.blockGap )\n\t\t: '';\n\n\t// Ensure a fallback gap value for the root layout definitions,\n\t// and use a fallback value if one is provided for the current block.\n\tif ( hasFallbackGapSupport ) {\n\t\tif ( selector === ROOT_BLOCK_SELECTOR ) {\n\t\t\tgapValue = ! gapValue ? '0.5em' : gapValue;\n\t\t} else if ( ! hasBlockGapSupport && fallbackGapValue ) {\n\t\t\tgapValue = fallbackGapValue;\n\t\t}\n\t}\n\n\tif ( gapValue && tree?.settings?.layout?.definitions ) {\n\t\tObject.values( tree.settings.layout.definitions ).forEach(\n\t\t\t( { className, name, spacingStyles } ) => {\n\t\t\t\t// Allow outputting fallback gap styles for flex layout type when block gap support isn't available.\n\t\t\t\tif ( ! hasBlockGapSupport && 'flex' !== name ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( spacingStyles?.length ) {\n\t\t\t\t\tspacingStyles.forEach( ( spacingStyle ) => {\n\t\t\t\t\t\tconst declarations = [];\n\n\t\t\t\t\t\tif ( spacingStyle.rules ) {\n\t\t\t\t\t\t\tObject.entries( spacingStyle.rules ).forEach(\n\t\t\t\t\t\t\t\t( [ cssProperty, cssValue ] ) => {\n\t\t\t\t\t\t\t\t\tdeclarations.push(\n\t\t\t\t\t\t\t\t\t\t`${ cssProperty }: ${\n\t\t\t\t\t\t\t\t\t\t\tcssValue ? cssValue : gapValue\n\t\t\t\t\t\t\t\t\t\t}`\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( declarations.length ) {\n\t\t\t\t\t\t\tlet combinedSelector = '';\n\n\t\t\t\t\t\t\tif ( ! hasBlockGapSupport ) {\n\t\t\t\t\t\t\t\t// For fallback gap styles, use lower specificity, to ensure styles do not unintentionally override theme styles.\n\t\t\t\t\t\t\t\tcombinedSelector =\n\t\t\t\t\t\t\t\t\tselector === ROOT_BLOCK_SELECTOR\n\t\t\t\t\t\t\t\t\t\t? `:where(.${ className }${\n\t\t\t\t\t\t\t\t\t\t\t\tspacingStyle?.selector || ''\n\t\t\t\t\t\t\t\t\t\t  })`\n\t\t\t\t\t\t\t\t\t\t: `:where(${ selector }.${ className }${\n\t\t\t\t\t\t\t\t\t\t\t\tspacingStyle?.selector || ''\n\t\t\t\t\t\t\t\t\t\t  })`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcombinedSelector =\n\t\t\t\t\t\t\t\t\tselector === ROOT_BLOCK_SELECTOR\n\t\t\t\t\t\t\t\t\t\t? `${ selector } .${ className }${\n\t\t\t\t\t\t\t\t\t\t\t\tspacingStyle?.selector || ''\n\t\t\t\t\t\t\t\t\t\t  }`\n\t\t\t\t\t\t\t\t\t\t: `${ selector }.${ className }${\n\t\t\t\t\t\t\t\t\t\t\t\tspacingStyle?.selector || ''\n\t\t\t\t\t\t\t\t\t\t  }`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\truleset += `${ combinedSelector } { ${ declarations.join(\n\t\t\t\t\t\t\t\t'; '\n\t\t\t\t\t\t\t) }; }`;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\t// For backwards compatibility, ensure the legacy block gap CSS variable is still available.\n\t\tif ( selector === ROOT_BLOCK_SELECTOR && hasBlockGapSupport ) {\n\t\t\truleset += `${ selector } { --wp--style--block-gap: ${ gapValue }; }`;\n\t\t}\n\t}\n\n\t// Output base styles\n\tif (\n\t\tselector === ROOT_BLOCK_SELECTOR &&\n\t\ttree?.settings?.layout?.definitions\n\t) {\n\t\tconst validDisplayModes = [ 'block', 'flex', 'grid' ];\n\t\tObject.values( tree.settings.layout.definitions ).forEach(\n\t\t\t( { className, displayMode, baseStyles } ) => {\n\t\t\t\tif (\n\t\t\t\t\tdisplayMode &&\n\t\t\t\t\tvalidDisplayModes.includes( displayMode )\n\t\t\t\t) {\n\t\t\t\t\truleset += `${ selector } .${ className } { display:${ displayMode }; }`;\n\t\t\t\t}\n\n\t\t\t\tif ( baseStyles?.length ) {\n\t\t\t\t\tbaseStyles.forEach( ( baseStyle ) => {\n\t\t\t\t\t\tconst declarations = [];\n\n\t\t\t\t\t\tif ( baseStyle.rules ) {\n\t\t\t\t\t\t\tObject.entries( baseStyle.rules ).forEach(\n\t\t\t\t\t\t\t\t( [ cssProperty, cssValue ] ) => {\n\t\t\t\t\t\t\t\t\tdeclarations.push(\n\t\t\t\t\t\t\t\t\t\t`${ cssProperty }: ${ cssValue }`\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( declarations.length ) {\n\t\t\t\t\t\t\tconst combinedSelector = `${ selector } .${ className }${\n\t\t\t\t\t\t\t\tbaseStyle?.selector || ''\n\t\t\t\t\t\t\t}`;\n\t\t\t\t\t\t\truleset += `${ combinedSelector } { ${ declarations.join(\n\t\t\t\t\t\t\t\t'; '\n\t\t\t\t\t\t\t) }; }`;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\treturn ruleset;\n}\n\nexport const getNodesWithStyles = ( tree, blockSelectors ) => {\n\tconst nodes = [];\n\n\tif ( ! tree?.styles ) {\n\t\treturn nodes;\n\t}\n\n\tconst pickStyleKeys = ( treeToPickFrom ) =>\n\t\tObject.fromEntries(\n\t\t\tObject.entries( treeToPickFrom ?? {} ).filter( ( [ key ] ) =>\n\t\t\t\t[\n\t\t\t\t\t'border',\n\t\t\t\t\t'color',\n\t\t\t\t\t'dimensions',\n\t\t\t\t\t'spacing',\n\t\t\t\t\t'typography',\n\t\t\t\t\t'filter',\n\t\t\t\t\t'outline',\n\t\t\t\t\t'shadow',\n\t\t\t\t].includes( key )\n\t\t\t)\n\t\t);\n\n\t// Top-level.\n\tconst styles = pickStyleKeys( tree.styles );\n\tif ( !! styles ) {\n\t\tnodes.push( {\n\t\t\tstyles,\n\t\t\tselector: ROOT_BLOCK_SELECTOR,\n\t\t} );\n\t}\n\n\tObject.entries( ELEMENTS ).forEach( ( [ name, selector ] ) => {\n\t\tif ( !! tree.styles?.elements[ name ] ) {\n\t\t\tnodes.push( {\n\t\t\t\tstyles: tree.styles?.elements[ name ],\n\t\t\t\tselector,\n\t\t\t} );\n\t\t}\n\t} );\n\n\t// Iterate over blocks: they can have styles & elements.\n\tObject.entries( tree.styles?.blocks ?? {} ).forEach(\n\t\t( [ blockName, node ] ) => {\n\t\t\tconst blockStyles = pickStyleKeys( node );\n\n\t\t\tif ( node?.variations ) {\n\t\t\t\tconst variations = {};\n\t\t\t\tObject.keys( node.variations ).forEach( ( variation ) => {\n\t\t\t\t\tvariations[ variation ] = pickStyleKeys(\n\t\t\t\t\t\tnode.variations[ variation ]\n\t\t\t\t\t);\n\t\t\t\t} );\n\t\t\t\tblockStyles.variations = variations;\n\t\t\t}\n\t\t\tif (\n\t\t\t\t!! blockStyles &&\n\t\t\t\t!! blockSelectors?.[ blockName ]?.selector\n\t\t\t) {\n\t\t\t\tnodes.push( {\n\t\t\t\t\tduotoneSelector:\n\t\t\t\t\t\tblockSelectors[ blockName ].duotoneSelector,\n\t\t\t\t\tfallbackGapValue:\n\t\t\t\t\t\tblockSelectors[ blockName ].fallbackGapValue,\n\t\t\t\t\thasLayoutSupport:\n\t\t\t\t\t\tblockSelectors[ blockName ].hasLayoutSupport,\n\t\t\t\t\tselector: blockSelectors[ blockName ].selector,\n\t\t\t\t\tstyles: blockStyles,\n\t\t\t\t\tfeatureSelectors:\n\t\t\t\t\t\tblockSelectors[ blockName ].featureSelectors,\n\t\t\t\t\tstyleVariationSelectors:\n\t\t\t\t\t\tblockSelectors[ blockName ].styleVariationSelectors,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tObject.entries( node?.elements ?? {} ).forEach(\n\t\t\t\t( [ elementName, value ] ) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\t!! value &&\n\t\t\t\t\t\t!! blockSelectors?.[ blockName ] &&\n\t\t\t\t\t\t!! ELEMENTS?.[ elementName ]\n\t\t\t\t\t) {\n\t\t\t\t\t\tnodes.push( {\n\t\t\t\t\t\t\tstyles: value,\n\t\t\t\t\t\t\tselector: blockSelectors[ blockName ].selector\n\t\t\t\t\t\t\t\t.split( ',' )\n\t\t\t\t\t\t\t\t.map( ( sel ) => {\n\t\t\t\t\t\t\t\t\tconst elementSelectors =\n\t\t\t\t\t\t\t\t\t\tELEMENTS[ elementName ].split( ',' );\n\t\t\t\t\t\t\t\t\treturn elementSelectors.map(\n\t\t\t\t\t\t\t\t\t\t( elementSelector ) =>\n\t\t\t\t\t\t\t\t\t\t\tsel + ' ' + elementSelector\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t.join( ',' ),\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t);\n\n\treturn nodes;\n};\n\nexport const getNodesWithSettings = ( tree, blockSelectors ) => {\n\tconst nodes = [];\n\n\tif ( ! tree?.settings ) {\n\t\treturn nodes;\n\t}\n\n\tconst pickPresets = ( treeToPickFrom ) => {\n\t\tconst presets = {};\n\t\tPRESET_METADATA.forEach( ( { path } ) => {\n\t\t\tconst value = get( treeToPickFrom, path, false );\n\t\t\tif ( value !== false ) {\n\t\t\t\tset( presets, path, value );\n\t\t\t}\n\t\t} );\n\t\treturn presets;\n\t};\n\n\t// Top-level.\n\tconst presets = pickPresets( tree.settings );\n\tconst custom = tree.settings?.custom;\n\tif ( ! isEmpty( presets ) || !! custom ) {\n\t\tnodes.push( {\n\t\t\tpresets,\n\t\t\tcustom,\n\t\t\tselector: ROOT_BLOCK_SELECTOR,\n\t\t} );\n\t}\n\n\t// Blocks.\n\tObject.entries( tree.settings?.blocks ?? {} ).forEach(\n\t\t( [ blockName, node ] ) => {\n\t\t\tconst blockPresets = pickPresets( node );\n\t\t\tconst blockCustom = node.custom;\n\t\t\tif ( ! isEmpty( blockPresets ) || !! blockCustom ) {\n\t\t\t\tnodes.push( {\n\t\t\t\t\tpresets: blockPresets,\n\t\t\t\t\tcustom: blockCustom,\n\t\t\t\t\tselector: blockSelectors[ blockName ].selector,\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t);\n\n\treturn nodes;\n};\n\nexport const toCustomProperties = ( tree, blockSelectors ) => {\n\tconst settings = getNodesWithSettings( tree, blockSelectors );\n\tlet ruleset = '';\n\tsettings.forEach( ( { presets, custom, selector } ) => {\n\t\tconst declarations = getPresetsDeclarations( presets, tree?.settings );\n\t\tconst customProps = flattenTree( custom, '--wp--custom--', '--' );\n\t\tif ( customProps.length > 0 ) {\n\t\t\tdeclarations.push( ...customProps );\n\t\t}\n\n\t\tif ( declarations.length > 0 ) {\n\t\t\truleset = ruleset + `${ selector }{${ declarations.join( ';' ) };}`;\n\t\t}\n\t} );\n\n\treturn ruleset;\n};\n\nexport const toStyles = (\n\ttree,\n\tblockSelectors,\n\thasBlockGapSupport,\n\thasFallbackGapSupport,\n\tdisableLayoutStyles = false\n) => {\n\tconst nodesWithStyles = getNodesWithStyles( tree, blockSelectors );\n\tconst nodesWithSettings = getNodesWithSettings( tree, blockSelectors );\n\tconst useRootPaddingAlign = tree?.settings?.useRootPaddingAwareAlignments;\n\tconst { contentSize, wideSize } = tree?.settings?.layout || {};\n\n\t/*\n\t * Reset default browser margin on the root body element.\n\t * This is set on the root selector **before** generating the ruleset\n\t * from the `theme.json`. This is to ensure that if the `theme.json` declares\n\t * `margin` in its `spacing` declaration for the `body` element then these\n\t * user-generated values take precedence in the CSS cascade.\n\t * @link https://github.com/WordPress/gutenberg/issues/36147.\n\t */\n\tlet ruleset = 'body {margin: 0;';\n\n\tif ( contentSize ) {\n\t\truleset += ` --wp--style--global--content-size: ${ contentSize };`;\n\t}\n\n\tif ( wideSize ) {\n\t\truleset += ` --wp--style--global--wide-size: ${ wideSize };`;\n\t}\n\n\tif ( useRootPaddingAlign ) {\n\t\t/*\n\t\t * These rules reproduce the ones from https://github.com/WordPress/gutenberg/blob/79103f124925d1f457f627e154f52a56228ed5ad/lib/class-wp-theme-json-gutenberg.php#L2508\n\t\t * almost exactly, but for the selectors that target block wrappers in the front end. This code only runs in the editor, so it doesn't need those selectors.\n\t\t */\n\t\truleset += `padding-right: 0; padding-left: 0; padding-top: var(--wp--style--root--padding-top); padding-bottom: var(--wp--style--root--padding-bottom) }\n\t\t\t.has-global-padding { padding-right: var(--wp--style--root--padding-right); padding-left: var(--wp--style--root--padding-left); }\n\t\t\t.has-global-padding :where(.has-global-padding) { padding-right: 0; padding-left: 0; }\n\t\t\t.has-global-padding > .alignfull { margin-right: calc(var(--wp--style--root--padding-right) * -1); margin-left: calc(var(--wp--style--root--padding-left) * -1); }\n\t\t\t.has-global-padding :where(.has-global-padding) > .alignfull { margin-right: 0; margin-left: 0; }\n\t\t\t.has-global-padding > .alignfull:where(:not(.has-global-padding)) > :where(.wp-block:not(.alignfull),p,h1,h2,h3,h4,h5,h6,ul,ol) { padding-right: var(--wp--style--root--padding-right); padding-left: var(--wp--style--root--padding-left); }\n\t\t\t.has-global-padding :where(.has-global-padding) > .alignfull:where(:not(.has-global-padding)) > :where(.wp-block:not(.alignfull),p,h1,h2,h3,h4,h5,h6,ul,ol) { padding-right: 0; padding-left: 0;`;\n\t}\n\n\truleset += '}';\n\n\tnodesWithStyles.forEach(\n\t\t( {\n\t\t\tselector,\n\t\t\tduotoneSelector,\n\t\t\tstyles,\n\t\t\tfallbackGapValue,\n\t\t\thasLayoutSupport,\n\t\t\tfeatureSelectors,\n\t\t\tstyleVariationSelectors,\n\t\t} ) => {\n\t\t\t// Process styles for block support features with custom feature level\n\t\t\t// CSS selectors set.\n\t\t\tif ( featureSelectors ) {\n\t\t\t\tObject.entries( featureSelectors ).forEach(\n\t\t\t\t\t( [ featureName, featureSelector ] ) => {\n\t\t\t\t\t\tif ( styles?.[ featureName ] ) {\n\t\t\t\t\t\t\tconst featureStyles = {\n\t\t\t\t\t\t\t\t[ featureName ]: styles[ featureName ],\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tconst featureDeclarations =\n\t\t\t\t\t\t\t\tgetStylesDeclarations( featureStyles );\n\t\t\t\t\t\t\tdelete styles[ featureName ];\n\n\t\t\t\t\t\t\tif ( !! featureDeclarations.length ) {\n\t\t\t\t\t\t\t\truleset =\n\t\t\t\t\t\t\t\t\truleset +\n\t\t\t\t\t\t\t\t\t`${ featureSelector }{${ featureDeclarations.join(\n\t\t\t\t\t\t\t\t\t\t';'\n\t\t\t\t\t\t\t\t\t) } }`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif ( styleVariationSelectors ) {\n\t\t\t\tObject.entries( styleVariationSelectors ).forEach(\n\t\t\t\t\t( [ styleVariationName, styleVariationSelector ] ) => {\n\t\t\t\t\t\tif ( styles?.variations?.[ styleVariationName ] ) {\n\t\t\t\t\t\t\t// If the block uses any custom selectors for block support, add those first.\n\t\t\t\t\t\t\tif ( featureSelectors ) {\n\t\t\t\t\t\t\t\tObject.entries( featureSelectors ).forEach(\n\t\t\t\t\t\t\t\t\t( [ featureName, featureSelector ] ) => {\n\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\tstyles?.variations?.[\n\t\t\t\t\t\t\t\t\t\t\t\tstyleVariationName\n\t\t\t\t\t\t\t\t\t\t\t]?.[ featureName ]\n\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\tconst featureStyles = {\n\t\t\t\t\t\t\t\t\t\t\t\t[ featureName ]:\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyles.variations[\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyleVariationName\n\t\t\t\t\t\t\t\t\t\t\t\t\t][ featureName ],\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\tconst featureDeclarations =\n\t\t\t\t\t\t\t\t\t\t\t\tgetStylesDeclarations(\n\t\t\t\t\t\t\t\t\t\t\t\t\tfeatureStyles\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\tdelete styles.variations[\n\t\t\t\t\t\t\t\t\t\t\t\tstyleVariationName\n\t\t\t\t\t\t\t\t\t\t\t][ featureName ];\n\n\t\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\t\t!! featureDeclarations.length\n\t\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\t\truleset =\n\t\t\t\t\t\t\t\t\t\t\t\t\truleset +\n\t\t\t\t\t\t\t\t\t\t\t\t\t`${ concatFeatureVariationSelectorString(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfeatureSelector,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyleVariationSelector\n\t\t\t\t\t\t\t\t\t\t\t\t\t) }{${ featureDeclarations.join(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t';'\n\t\t\t\t\t\t\t\t\t\t\t\t\t) } }`;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Otherwise add regular selectors.\n\t\t\t\t\t\t\tconst styleVariationDeclarations =\n\t\t\t\t\t\t\t\tgetStylesDeclarations(\n\t\t\t\t\t\t\t\t\tstyles?.variations?.[ styleVariationName ],\n\t\t\t\t\t\t\t\t\tstyleVariationSelector,\n\t\t\t\t\t\t\t\t\tuseRootPaddingAlign,\n\t\t\t\t\t\t\t\t\ttree\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif ( !! styleVariationDeclarations.length ) {\n\t\t\t\t\t\t\t\truleset =\n\t\t\t\t\t\t\t\t\truleset +\n\t\t\t\t\t\t\t\t\t`${ styleVariationSelector }{${ styleVariationDeclarations.join(\n\t\t\t\t\t\t\t\t\t\t';'\n\t\t\t\t\t\t\t\t\t) }}`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst duotoneStyles = {};\n\t\t\tif ( styles?.filter ) {\n\t\t\t\tduotoneStyles.filter = styles.filter;\n\t\t\t\tdelete styles.filter;\n\t\t\t}\n\n\t\t\t// Process duotone styles (they use color.__experimentalDuotone selector).\n\t\t\tif ( duotoneSelector ) {\n\t\t\t\tconst duotoneDeclarations =\n\t\t\t\t\tgetStylesDeclarations( duotoneStyles );\n\t\t\t\tif ( duotoneDeclarations.length > 0 ) {\n\t\t\t\t\truleset =\n\t\t\t\t\t\truleset +\n\t\t\t\t\t\t`${ scopeSelector(\n\t\t\t\t\t\t\tselector,\n\t\t\t\t\t\t\tduotoneSelector\n\t\t\t\t\t\t) }{${ duotoneDeclarations.join( ';' ) };}`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Process blockGap and layout styles.\n\t\t\tif (\n\t\t\t\t! disableLayoutStyles &&\n\t\t\t\t( ROOT_BLOCK_SELECTOR === selector || hasLayoutSupport )\n\t\t\t) {\n\t\t\t\truleset += getLayoutStyles( {\n\t\t\t\t\ttree,\n\t\t\t\t\tstyle: styles,\n\t\t\t\t\tselector,\n\t\t\t\t\thasBlockGapSupport,\n\t\t\t\t\thasFallbackGapSupport,\n\t\t\t\t\tfallbackGapValue,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// Process the remaining block styles (they use either normal block class or __experimentalSelector).\n\t\t\tconst declarations = getStylesDeclarations(\n\t\t\t\tstyles,\n\t\t\t\tselector,\n\t\t\t\tuseRootPaddingAlign,\n\t\t\t\ttree\n\t\t\t);\n\t\t\tif ( declarations?.length ) {\n\t\t\t\truleset =\n\t\t\t\t\truleset + `${ selector }{${ declarations.join( ';' ) };}`;\n\t\t\t}\n\n\t\t\t// Check for pseudo selector in `styles` and handle separately.\n\t\t\tconst pseudoSelectorStyles = Object.entries( styles ).filter(\n\t\t\t\t( [ key ] ) => key.startsWith( ':' )\n\t\t\t);\n\n\t\t\tif ( pseudoSelectorStyles?.length ) {\n\t\t\t\tpseudoSelectorStyles.forEach(\n\t\t\t\t\t( [ pseudoKey, pseudoStyle ] ) => {\n\t\t\t\t\t\tconst pseudoDeclarations =\n\t\t\t\t\t\t\tgetStylesDeclarations( pseudoStyle );\n\n\t\t\t\t\t\tif ( ! pseudoDeclarations?.length ) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// `selector` maybe provided in a form\n\t\t\t\t\t\t// where block level selectors have sub element\n\t\t\t\t\t\t// selectors appended to them as a comma separated\n\t\t\t\t\t\t// string.\n\t\t\t\t\t\t// e.g. `h1 a,h2 a,h3 a,h4 a,h5 a,h6 a`;\n\t\t\t\t\t\t// Split and append pseudo selector to create\n\t\t\t\t\t\t// the proper rules to target the elements.\n\t\t\t\t\t\tconst _selector = selector\n\t\t\t\t\t\t\t.split( ',' )\n\t\t\t\t\t\t\t.map( ( sel ) => sel + pseudoKey )\n\t\t\t\t\t\t\t.join( ',' );\n\n\t\t\t\t\t\tconst pseudoRule = `${ _selector }{${ pseudoDeclarations.join(\n\t\t\t\t\t\t\t';'\n\t\t\t\t\t\t) };}`;\n\n\t\t\t\t\t\truleset = ruleset + pseudoRule;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t);\n\n\t/* Add alignment / layout styles */\n\truleset =\n\t\truleset +\n\t\t'.wp-site-blocks > .alignleft { float: left; margin-right: 2em; }';\n\truleset =\n\t\truleset +\n\t\t'.wp-site-blocks > .alignright { float: right; margin-left: 2em; }';\n\truleset =\n\t\truleset +\n\t\t'.wp-site-blocks > .aligncenter { justify-content: center; margin-left: auto; margin-right: auto; }';\n\n\tif ( hasBlockGapSupport ) {\n\t\t// Use fallback of `0.5em` just in case, however if there is blockGap support, there should nearly always be a real value.\n\t\tconst gapValue =\n\t\t\tgetGapCSSValue( tree?.styles?.spacing?.blockGap ) || '0.5em';\n\t\truleset =\n\t\t\truleset +\n\t\t\t'.wp-site-blocks > * { margin-block-start: 0; margin-block-end: 0; }';\n\t\truleset =\n\t\t\truleset +\n\t\t\t`.wp-site-blocks > * + * { margin-block-start: ${ gapValue }; }`;\n\t}\n\n\tnodesWithSettings.forEach( ( { selector, presets } ) => {\n\t\tif ( ROOT_BLOCK_SELECTOR === selector ) {\n\t\t\t// Do not add extra specificity for top-level classes.\n\t\t\tselector = '';\n\t\t}\n\n\t\tconst classes = getPresetsClasses( selector, presets );\n\t\tif ( ! isEmpty( classes ) ) {\n\t\t\truleset = ruleset + classes;\n\t\t}\n\t} );\n\n\treturn ruleset;\n};\n\nexport function toSvgFilters( tree, blockSelectors ) {\n\tconst nodesWithSettings = getNodesWithSettings( tree, blockSelectors );\n\treturn nodesWithSettings.flatMap( ( { presets } ) => {\n\t\treturn getPresetsSvgFilters( presets );\n\t} );\n}\n\nexport const getBlockSelectors = ( blockTypes, getBlockStyles ) => {\n\tconst result = {};\n\tblockTypes.forEach( ( blockType ) => {\n\t\tconst name = blockType.name;\n\t\tconst selector =\n\t\t\tblockType?.supports?.__experimentalSelector ??\n\t\t\t'.wp-block-' + name.replace( 'core/', '' ).replace( '/', '-' );\n\t\tconst duotoneSelector =\n\t\t\tblockType?.supports?.color?.__experimentalDuotone ?? null;\n\t\tconst hasLayoutSupport = !! blockType?.supports?.__experimentalLayout;\n\t\tconst fallbackGapValue =\n\t\t\tblockType?.supports?.spacing?.blockGap?.__experimentalDefault;\n\n\t\tconst blockStyleVariations = getBlockStyles( name );\n\t\tconst styleVariationSelectors = {};\n\t\tif ( blockStyleVariations?.length ) {\n\t\t\tblockStyleVariations.forEach( ( variation ) => {\n\t\t\t\tconst styleVariationSelector = `.is-style-${ variation.name }${ selector }`;\n\t\t\t\tstyleVariationSelectors[ variation.name ] =\n\t\t\t\t\tstyleVariationSelector;\n\t\t\t} );\n\t\t}\n\t\t// For each block support feature add any custom selectors.\n\t\tconst featureSelectors = {};\n\t\tObject.entries( BLOCK_SUPPORT_FEATURE_LEVEL_SELECTORS ).forEach(\n\t\t\t( [ featureKey, featureName ] ) => {\n\t\t\t\tconst featureSelector =\n\t\t\t\t\tblockType?.supports?.[ featureKey ]?.__experimentalSelector;\n\n\t\t\t\tif ( featureSelector ) {\n\t\t\t\t\tfeatureSelectors[ featureName ] = scopeSelector(\n\t\t\t\t\t\tselector,\n\t\t\t\t\t\tfeatureSelector\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tresult[ name ] = {\n\t\t\tduotoneSelector,\n\t\t\tfallbackGapValue,\n\t\t\tfeatureSelectors: Object.keys( featureSelectors ).length\n\t\t\t\t? featureSelectors\n\t\t\t\t: undefined,\n\t\t\thasLayoutSupport,\n\t\t\tname,\n\t\t\tselector,\n\t\t\tstyleVariationSelectors: Object.keys( styleVariationSelectors )\n\t\t\t\t.length\n\t\t\t\t? styleVariationSelectors\n\t\t\t\t: undefined,\n\t\t};\n\t} );\n\n\treturn result;\n};\n\n/**\n * If there is a separator block whose color is defined in theme.json via background,\n * update the separator color to the same value by using border color.\n *\n * @param {Object} config Theme.json configuration file object.\n * @return {Object} configTheme.json configuration file object updated.\n */\nfunction updateConfigWithSeparator( config ) {\n\tconst needsSeparatorStyleUpdate =\n\t\tconfig.styles?.blocks[ 'core/separator' ] &&\n\t\tconfig.styles?.blocks[ 'core/separator' ].color?.background &&\n\t\t! config.styles?.blocks[ 'core/separator' ].color?.text &&\n\t\t! config.styles?.blocks[ 'core/separator' ].border?.color;\n\tif ( needsSeparatorStyleUpdate ) {\n\t\treturn {\n\t\t\t...config,\n\t\t\tstyles: {\n\t\t\t\t...config.styles,\n\t\t\t\tblocks: {\n\t\t\t\t\t...config.styles.blocks,\n\t\t\t\t\t'core/separator': {\n\t\t\t\t\t\t...config.styles.blocks[ 'core/separator' ],\n\t\t\t\t\t\tcolor: {\n\t\t\t\t\t\t\t...config.styles.blocks[ 'core/separator' ].color,\n\t\t\t\t\t\t\ttext: config.styles?.blocks[ 'core/separator' ]\n\t\t\t\t\t\t\t\t.color.background,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\treturn config;\n}\n\nconst processCSSNesting = ( css, blockSelector ) => {\n\tlet processedCSS = '';\n\n\t// Split CSS nested rules.\n\tconst parts = css.split( '&' );\n\tparts.forEach( ( part ) => {\n\t\tprocessedCSS += ! part.includes( '{' )\n\t\t\t? blockSelector + '{' + part + '}' // If the part doesn't contain braces, it applies to the root level.\n\t\t\t: blockSelector + part; // Prepend the selector, which effectively replaces the \"&\" character.\n\t} );\n\treturn processedCSS;\n};\n\nexport function useGlobalStylesOutput() {\n\tlet { merged: mergedConfig } = useContext( GlobalStylesContext );\n\n\tconst [ blockGap ] = useGlobalSetting( 'spacing.blockGap' );\n\tconst hasBlockGapSupport = blockGap !== null;\n\tconst hasFallbackGapSupport = ! hasBlockGapSupport; // This setting isn't useful yet: it exists as a placeholder for a future explicit fallback styles support.\n\tconst disableLayoutStyles = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( blockEditorStore );\n\t\treturn !! getSettings().disableLayoutStyles;\n\t} );\n\n\tconst getBlockStyles = useSelect( ( select ) => {\n\t\treturn select( blocksStore ).getBlockStyles;\n\t}, [] );\n\n\treturn useMemo( () => {\n\t\tif ( ! mergedConfig?.styles || ! mergedConfig?.settings ) {\n\t\t\treturn [];\n\t\t}\n\t\tmergedConfig = updateConfigWithSeparator( mergedConfig );\n\n\t\tconst blockSelectors = getBlockSelectors(\n\t\t\tgetBlockTypes(),\n\t\t\tgetBlockStyles\n\t\t);\n\n\t\tconst customProperties = toCustomProperties(\n\t\t\tmergedConfig,\n\t\t\tblockSelectors\n\t\t);\n\t\tconst globalStyles = toStyles(\n\t\t\tmergedConfig,\n\t\t\tblockSelectors,\n\t\t\thasBlockGapSupport,\n\t\t\thasFallbackGapSupport,\n\t\t\tdisableLayoutStyles\n\t\t);\n\n\t\tconst filters = toSvgFilters( mergedConfig, blockSelectors );\n\t\tconst stylesheets = [\n\t\t\t{\n\t\t\t\tcss: customProperties,\n\t\t\t\tisGlobalStyles: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tcss: globalStyles,\n\t\t\t\tisGlobalStyles: true,\n\t\t\t},\n\t\t\t// Load custom CSS in own stylesheet so that any invalid CSS entered in the input won't break all the global styles in the editor.\n\t\t\t{\n\t\t\t\tcss: mergedConfig.styles.css ?? '',\n\t\t\t\tisGlobalStyles: true,\n\t\t\t},\n\t\t];\n\n\t\t// Loop through the blocks to check if there are custom CSS values.\n\t\t// If there are, get the block selector and push the selector together with\n\t\t// the CSS value to the 'stylesheets' array.\n\t\tgetBlockTypes().forEach( ( blockType ) => {\n\t\t\tif ( mergedConfig.styles.blocks[ blockType.name ]?.css ) {\n\t\t\t\tconst selector = blockSelectors[ blockType.name ].selector;\n\t\t\t\tstylesheets.push( {\n\t\t\t\t\tcss: processCSSNesting(\n\t\t\t\t\t\tmergedConfig.styles.blocks[ blockType.name ]?.css,\n\t\t\t\t\t\tselector\n\t\t\t\t\t),\n\t\t\t\t\tisGlobalStyles: true,\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\n\t\treturn [ stylesheets, mergedConfig.settings, filters ];\n\t}, [\n\t\thasBlockGapSupport,\n\t\thasFallbackGapSupport,\n\t\tmergedConfig,\n\t\tdisableLayoutStyles,\n\t] );\n}\n"]}