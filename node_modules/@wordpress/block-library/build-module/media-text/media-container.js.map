{"version":3,"sources":["@wordpress/block-library/src/media-text/media-container.js"],"names":["classnames","ResizableBox","Spinner","BlockControls","BlockIcon","MediaPlaceholder","MediaReplaceFlow","store","blockEditorStore","__","useViewportMatch","useDispatch","forwardRef","isBlobURL","noticesStore","icon","ALLOWED_MEDIA_TYPES","noop","imageFillStyles","url","focalPoint","backgroundImage","backgroundPosition","Math","round","x","y","ResizableBoxContainer","ref","isSelected","isStackedOnMobile","props","isMobile","ToolbarEditButton","mediaId","mediaUrl","onSelectMedia","PlaceholderContainer","className","createErrorNotice","onUploadError","message","type","title","MediaContainer","commitWidthChange","imageFill","mediaAlt","mediaPosition","mediaType","mediaWidth","onWidthChange","isContentLocked","isTemporaryMedia","toggleSelection","onResizeStart","onResize","event","direction","elt","parseInt","style","width","onResizeStop","enablePositions","right","left","backgroundStyles","mediaTypeRenderers","image","video"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { ResizableBox, Spinner } from '@wordpress/components';\nimport {\n\tBlockControls,\n\tBlockIcon,\n\tMediaPlaceholder,\n\tMediaReplaceFlow,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { __ } from '@wordpress/i18n';\nimport { useViewportMatch } from '@wordpress/compose';\nimport { useDispatch } from '@wordpress/data';\nimport { forwardRef } from '@wordpress/element';\nimport { isBlobURL } from '@wordpress/blob';\nimport { store as noticesStore } from '@wordpress/notices';\n\n/**\n * Internal dependencies\n */\nimport icon from './media-container-icon';\n\n/**\n * Constants\n */\nconst ALLOWED_MEDIA_TYPES = [ 'image', 'video' ];\nconst noop = () => {};\n\nexport function imageFillStyles( url, focalPoint ) {\n\treturn url\n\t\t? {\n\t\t\t\tbackgroundImage: `url(${ url })`,\n\t\t\t\tbackgroundPosition: focalPoint\n\t\t\t\t\t? `${ Math.round( focalPoint.x * 100 ) }% ${ Math.round(\n\t\t\t\t\t\t\tfocalPoint.y * 100\n\t\t\t\t\t  ) }%`\n\t\t\t\t\t: `50% 50%`,\n\t\t  }\n\t\t: {};\n}\n\nconst ResizableBoxContainer = forwardRef(\n\t( { isSelected, isStackedOnMobile, ...props }, ref ) => {\n\t\tconst isMobile = useViewportMatch( 'small', '<' );\n\t\treturn (\n\t\t\t<ResizableBox\n\t\t\t\tref={ ref }\n\t\t\t\tshowHandle={\n\t\t\t\t\tisSelected && ( ! isMobile || ! isStackedOnMobile )\n\t\t\t\t}\n\t\t\t\t{ ...props }\n\t\t\t/>\n\t\t);\n\t}\n);\n\nfunction ToolbarEditButton( { mediaId, mediaUrl, onSelectMedia } ) {\n\treturn (\n\t\t<BlockControls group=\"other\">\n\t\t\t<MediaReplaceFlow\n\t\t\t\tmediaId={ mediaId }\n\t\t\t\tmediaURL={ mediaUrl }\n\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\taccept=\"image/*,video/*\"\n\t\t\t\tonSelect={ onSelectMedia }\n\t\t\t/>\n\t\t</BlockControls>\n\t);\n}\n\nfunction PlaceholderContainer( { className, mediaUrl, onSelectMedia } ) {\n\tconst { createErrorNotice } = useDispatch( noticesStore );\n\n\tconst onUploadError = ( message ) => {\n\t\tcreateErrorNotice( message, { type: 'snackbar' } );\n\t};\n\n\treturn (\n\t\t<MediaPlaceholder\n\t\t\ticon={ <BlockIcon icon={ icon } /> }\n\t\t\tlabels={ {\n\t\t\t\ttitle: __( 'Media area' ),\n\t\t\t} }\n\t\t\tclassName={ className }\n\t\t\tonSelect={ onSelectMedia }\n\t\t\taccept=\"image/*,video/*\"\n\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\tonError={ onUploadError }\n\t\t\tdisableMediaButtons={ mediaUrl }\n\t\t/>\n\t);\n}\n\nfunction MediaContainer( props, ref ) {\n\tconst {\n\t\tclassName,\n\t\tcommitWidthChange,\n\t\tfocalPoint,\n\t\timageFill,\n\t\tisSelected,\n\t\tisStackedOnMobile,\n\t\tmediaAlt,\n\t\tmediaId,\n\t\tmediaPosition,\n\t\tmediaType,\n\t\tmediaUrl,\n\t\tmediaWidth,\n\t\tonSelectMedia,\n\t\tonWidthChange,\n\t\tisContentLocked,\n\t} = props;\n\n\tconst isTemporaryMedia = ! mediaId && isBlobURL( mediaUrl );\n\n\tconst { toggleSelection } = useDispatch( blockEditorStore );\n\n\tif ( mediaUrl ) {\n\t\tconst onResizeStart = () => {\n\t\t\ttoggleSelection( false );\n\t\t};\n\t\tconst onResize = ( event, direction, elt ) => {\n\t\t\tonWidthChange( parseInt( elt.style.width ) );\n\t\t};\n\t\tconst onResizeStop = ( event, direction, elt ) => {\n\t\t\ttoggleSelection( true );\n\t\t\tcommitWidthChange( parseInt( elt.style.width ) );\n\t\t};\n\t\tconst enablePositions = {\n\t\t\tright: ! isContentLocked && mediaPosition === 'left',\n\t\t\tleft: ! isContentLocked && mediaPosition === 'right',\n\t\t};\n\n\t\tconst backgroundStyles =\n\t\t\tmediaType === 'image' && imageFill\n\t\t\t\t? imageFillStyles( mediaUrl, focalPoint )\n\t\t\t\t: {};\n\n\t\tconst mediaTypeRenderers = {\n\t\t\timage: () => <img src={ mediaUrl } alt={ mediaAlt } />,\n\t\t\tvideo: () => <video controls src={ mediaUrl } />,\n\t\t};\n\n\t\treturn (\n\t\t\t<ResizableBoxContainer\n\t\t\t\tas=\"figure\"\n\t\t\t\tclassName={ classnames(\n\t\t\t\t\tclassName,\n\t\t\t\t\t'editor-media-container__resizer',\n\t\t\t\t\t{ 'is-transient': isTemporaryMedia }\n\t\t\t\t) }\n\t\t\t\tstyle={ backgroundStyles }\n\t\t\t\tsize={ { width: mediaWidth + '%' } }\n\t\t\t\tminWidth=\"10%\"\n\t\t\t\tmaxWidth=\"100%\"\n\t\t\t\tenable={ enablePositions }\n\t\t\t\tonResizeStart={ onResizeStart }\n\t\t\t\tonResize={ onResize }\n\t\t\t\tonResizeStop={ onResizeStop }\n\t\t\t\taxis=\"x\"\n\t\t\t\tisSelected={ isSelected }\n\t\t\t\tisStackedOnMobile={ isStackedOnMobile }\n\t\t\t\tref={ ref }\n\t\t\t>\n\t\t\t\t<ToolbarEditButton\n\t\t\t\t\tonSelectMedia={ onSelectMedia }\n\t\t\t\t\tmediaUrl={ mediaUrl }\n\t\t\t\t\tmediaId={ mediaId }\n\t\t\t\t/>\n\t\t\t\t{ ( mediaTypeRenderers[ mediaType ] || noop )() }\n\t\t\t\t{ isTemporaryMedia && <Spinner /> }\n\t\t\t\t<PlaceholderContainer { ...props } />\n\t\t\t</ResizableBoxContainer>\n\t\t);\n\t}\n\n\treturn <PlaceholderContainer { ...props } />;\n}\n\nexport default forwardRef( MediaContainer );\n"]}