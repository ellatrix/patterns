{"version":3,"sources":["@wordpress/block-library/src/navigation/edit/use-create-navigation-menu.js"],"names":["serialize","store","coreStore","useDispatch","useState","useCallback","useGenerateDefaultNavigationTitle","CREATE_NAVIGATION_MENU_SUCCESS","CREATE_NAVIGATION_MENU_ERROR","CREATE_NAVIGATION_MENU_PENDING","CREATE_NAVIGATION_MENU_IDLE","useCreateNavigationMenu","clientId","status","setStatus","value","setValue","error","setError","saveEntityRecord","editEntityRecord","generateDefaultTitle","create","title","blocks","postStatus","Error","catch","err","message","cause","record","content","then","response","id","isIdle","isPending","isSuccess","isError"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAT,QAA0B,mBAA1B;AACA,SAASC,KAAK,IAAIC,SAAlB,QAAmC,sBAAnC;AACA,SAASC,WAAT,QAA4B,iBAA5B;AACA,SAASC,QAAT,EAAmBC,WAAnB,QAAsC,oBAAtC;AAEA;AACA;AACA;;AACA,OAAOC,iCAAP,MAA8C,yCAA9C;AAEA,OAAO,MAAMC,8BAA8B,GAAG,SAAvC;AACP,OAAO,MAAMC,4BAA4B,GAAG,OAArC;AACP,OAAO,MAAMC,8BAA8B,GAAG,SAAvC;AACP,OAAO,MAAMC,2BAA2B,GAAG,MAApC;AAEP,eAAe,SAASC,uBAAT,CAAkCC,QAAlC,EAA6C;AAC3D,QAAM,CAAEC,MAAF,EAAUC,SAAV,IAAwBV,QAAQ,CAAEM,2BAAF,CAAtC;AACA,QAAM,CAAEK,KAAF,EAASC,QAAT,IAAsBZ,QAAQ,CAAE,IAAF,CAApC;AACA,QAAM,CAAEa,KAAF,EAASC,QAAT,IAAsBd,QAAQ,CAAE,IAAF,CAApC;AAEA,QAAM;AAAEe,IAAAA,gBAAF;AAAoBC,IAAAA;AAApB,MAAyCjB,WAAW,CAAED,SAAF,CAA1D;AACA,QAAMmB,oBAAoB,GAAGf,iCAAiC,CAAEM,QAAF,CAA9D,CAN2D,CAQ3D;AACA;;AACA,QAAMU,MAAM,GAAGjB,WAAW,CACzB,kBAAmD;AAAA,QAA3CkB,KAA2C,uEAAnC,IAAmC;AAAA,QAA7BC,MAA6B,uEAApB,EAAoB;AAAA,QAAhBC,UAAgB;;AAClD;AACA;AACA;AACA,QAAKF,KAAK,IAAI,OAAOA,KAAP,KAAiB,QAA/B,EAA0C;AACzCL,MAAAA,QAAQ,CACP,uDADO,CAAR;AAGAJ,MAAAA,SAAS,CAAEN,4BAAF,CAAT;AACA,YAAM,IAAIkB,KAAJ,CACJ,oDADI,CAAN;AAGA;;AAEDZ,IAAAA,SAAS,CAAEL,8BAAF,CAAT;AACAO,IAAAA,QAAQ,CAAE,IAAF,CAAR;AACAE,IAAAA,QAAQ,CAAE,IAAF,CAAR;;AAEA,QAAK,CAAEK,KAAP,EAAe;AACdA,MAAAA,KAAK,GAAG,MAAMF,oBAAoB,GAAGM,KAAvB,CAAgCC,GAAF,IAAW;AACtDV,QAAAA,QAAQ,CAAEU,GAAF,aAAEA,GAAF,uBAAEA,GAAG,CAAEC,OAAP,CAAR;AACAf,QAAAA,SAAS,CAAEN,4BAAF,CAAT;AACA,cAAM,IAAIkB,KAAJ,CACL,yDADK,EAEL;AACCI,UAAAA,KAAK,EAAEF;AADR,SAFK,CAAN;AAMA,OATa,CAAd;AAUA;;AACD,UAAMG,MAAM,GAAG;AACdR,MAAAA,KADc;AAEdS,MAAAA,OAAO,EAAEhC,SAAS,CAAEwB,MAAF,CAFJ;AAGdX,MAAAA,MAAM,EAAEY;AAHM,KAAf,CA9BkD,CAoClD;;AACA,WAAON,gBAAgB,CAAE,UAAF,EAAc,eAAd,EAA+BY,MAA/B,CAAhB,CACLE,IADK,CACGC,QAAF,IAAgB;AACtBlB,MAAAA,QAAQ,CAAEkB,QAAF,CAAR;AACApB,MAAAA,SAAS,CAAEP,8BAAF,CAAT,CAFsB,CAItB;AACA;;AACA,UAAKkB,UAAU,KAAK,SAApB,EAAgC;AAC/BL,QAAAA,gBAAgB,CACf,UADe,EAEf,eAFe,EAGfc,QAAQ,CAACC,EAHM,EAIf;AAAEtB,UAAAA,MAAM,EAAE;AAAV,SAJe,CAAhB;AAMA;;AAED,aAAOqB,QAAP;AACA,KAjBK,EAkBLP,KAlBK,CAkBIC,GAAF,IAAW;AAClBV,MAAAA,QAAQ,CAAEU,GAAF,aAAEA,GAAF,uBAAEA,GAAG,CAAEC,OAAP,CAAR;AACAf,MAAAA,SAAS,CAAEN,4BAAF,CAAT;AACA,YAAM,IAAIkB,KAAJ,CAAW,oCAAX,EAAiD;AACtDI,QAAAA,KAAK,EAAEF;AAD+C,OAAjD,CAAN;AAGA,KAxBK,CAAP;AAyBA,GA/DwB,EAgEzB,CAAE5B,SAAF,EAAamB,gBAAb,EAA+BC,gBAA/B,EAAiDC,oBAAjD,CAhEyB,CAA1B;AAmEA,SAAO;AACNC,IAAAA,MADM;AAENT,IAAAA,MAFM;AAGNE,IAAAA,KAHM;AAINE,IAAAA,KAJM;AAKNmB,IAAAA,MAAM,EAAEvB,MAAM,KAAKH,2BALb;AAMN2B,IAAAA,SAAS,EAAExB,MAAM,KAAKJ,8BANhB;AAON6B,IAAAA,SAAS,EAAEzB,MAAM,KAAKN,8BAPhB;AAQNgC,IAAAA,OAAO,EAAE1B,MAAM,KAAKL;AARd,GAAP;AAUA","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { serialize } from '@wordpress/blocks';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { useDispatch } from '@wordpress/data';\nimport { useState, useCallback } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport useGenerateDefaultNavigationTitle from './use-generate-default-navigation-title';\n\nexport const CREATE_NAVIGATION_MENU_SUCCESS = 'success';\nexport const CREATE_NAVIGATION_MENU_ERROR = 'error';\nexport const CREATE_NAVIGATION_MENU_PENDING = 'pending';\nexport const CREATE_NAVIGATION_MENU_IDLE = 'idle';\n\nexport default function useCreateNavigationMenu( clientId ) {\n\tconst [ status, setStatus ] = useState( CREATE_NAVIGATION_MENU_IDLE );\n\tconst [ value, setValue ] = useState( null );\n\tconst [ error, setError ] = useState( null );\n\n\tconst { saveEntityRecord, editEntityRecord } = useDispatch( coreStore );\n\tconst generateDefaultTitle = useGenerateDefaultNavigationTitle( clientId );\n\n\t// This callback uses data from the two placeholder steps and only creates\n\t// a new navigation menu when the user completes the final step.\n\tconst create = useCallback(\n\t\tasync ( title = null, blocks = [], postStatus ) => {\n\t\t\t// Guard against creating Navigations without a title.\n\t\t\t// Note you can pass no title, but if one is passed it must be\n\t\t\t// a string otherwise the title may end up being empty.\n\t\t\tif ( title && typeof title !== 'string' ) {\n\t\t\t\tsetError(\n\t\t\t\t\t'Invalid title supplied when creating Navigation Menu.'\n\t\t\t\t);\n\t\t\t\tsetStatus( CREATE_NAVIGATION_MENU_ERROR );\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`Value of supplied title argument was not a string.`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tsetStatus( CREATE_NAVIGATION_MENU_PENDING );\n\t\t\tsetValue( null );\n\t\t\tsetError( null );\n\n\t\t\tif ( ! title ) {\n\t\t\t\ttitle = await generateDefaultTitle().catch( ( err ) => {\n\t\t\t\t\tsetError( err?.message );\n\t\t\t\t\tsetStatus( CREATE_NAVIGATION_MENU_ERROR );\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t'Failed to create title when saving new Navigation Menu.',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcause: err,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} );\n\t\t\t}\n\t\t\tconst record = {\n\t\t\t\ttitle,\n\t\t\t\tcontent: serialize( blocks ),\n\t\t\t\tstatus: postStatus,\n\t\t\t};\n\n\t\t\t// Return affords ability to await on this function directly\n\t\t\treturn saveEntityRecord( 'postType', 'wp_navigation', record )\n\t\t\t\t.then( ( response ) => {\n\t\t\t\t\tsetValue( response );\n\t\t\t\t\tsetStatus( CREATE_NAVIGATION_MENU_SUCCESS );\n\n\t\t\t\t\t// Set the status to publish so that the Navigation block\n\t\t\t\t\t// shows up in the multi entity save flow.\n\t\t\t\t\tif ( postStatus !== 'publish' ) {\n\t\t\t\t\t\teditEntityRecord(\n\t\t\t\t\t\t\t'postType',\n\t\t\t\t\t\t\t'wp_navigation',\n\t\t\t\t\t\t\tresponse.id,\n\t\t\t\t\t\t\t{ status: 'publish' }\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn response;\n\t\t\t\t} )\n\t\t\t\t.catch( ( err ) => {\n\t\t\t\t\tsetError( err?.message );\n\t\t\t\t\tsetStatus( CREATE_NAVIGATION_MENU_ERROR );\n\t\t\t\t\tthrow new Error( 'Unable to save new Navigation Menu', {\n\t\t\t\t\t\tcause: err,\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t},\n\t\t[ serialize, saveEntityRecord, editEntityRecord, generateDefaultTitle ]\n\t);\n\n\treturn {\n\t\tcreate,\n\t\tstatus,\n\t\tvalue,\n\t\terror,\n\t\tisIdle: status === CREATE_NAVIGATION_MENU_IDLE,\n\t\tisPending: status === CREATE_NAVIGATION_MENU_PENDING,\n\t\tisSuccess: status === CREATE_NAVIGATION_MENU_SUCCESS,\n\t\tisError: status === CREATE_NAVIGATION_MENU_ERROR,\n\t};\n}\n"]}