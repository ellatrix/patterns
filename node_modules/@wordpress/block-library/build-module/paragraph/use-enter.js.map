{"version":3,"sources":["@wordpress/block-library/src/paragraph/use-enter.js"],"names":["useRef","useRefEffect","ENTER","useSelect","useDispatch","useRegistry","store","blockEditorStore","hasBlockSupport","createBlock","useOnEnter","props","batch","moveBlocksToPosition","replaceInnerBlocks","duplicateBlocks","insertBlock","getBlockRootClientId","getBlockIndex","getBlockOrder","getBlockName","getBlock","getNextBlockClientId","propsRef","current","element","onKeyDown","event","defaultPrevented","keyCode","content","clientId","length","wrapperClientId","order","preventDefault","position","indexOf","wrapperBlock","blockIndex","innerBlocks","slice","addEventListener","removeEventListener"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\nimport { ENTER } from '@wordpress/keycodes';\nimport { useSelect, useDispatch, useRegistry } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { hasBlockSupport, createBlock } from '@wordpress/blocks';\n\nexport function useOnEnter( props ) {\n\tconst { batch } = useRegistry();\n\tconst {\n\t\tmoveBlocksToPosition,\n\t\treplaceInnerBlocks,\n\t\tduplicateBlocks,\n\t\tinsertBlock,\n\t} = useDispatch( blockEditorStore );\n\tconst {\n\t\tgetBlockRootClientId,\n\t\tgetBlockIndex,\n\t\tgetBlockOrder,\n\t\tgetBlockName,\n\t\tgetBlock,\n\t\tgetNextBlockClientId,\n\t} = useSelect( blockEditorStore );\n\tconst propsRef = useRef( props );\n\tpropsRef.current = props;\n\treturn useRefEffect( ( element ) => {\n\t\tfunction onKeyDown( event ) {\n\t\t\tif ( event.defaultPrevented ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( event.keyCode !== ENTER ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { content, clientId } = propsRef.current;\n\n\t\t\t// The paragraph should be empty.\n\t\t\tif ( content.length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst wrapperClientId = getBlockRootClientId( clientId );\n\n\t\t\tif (\n\t\t\t\t! hasBlockSupport(\n\t\t\t\t\tgetBlockName( wrapperClientId ),\n\t\t\t\t\t'__experimentalOnEnter',\n\t\t\t\t\tfalse\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst order = getBlockOrder( wrapperClientId );\n\n\t\t\tevent.preventDefault();\n\n\t\t\tconst position = order.indexOf( clientId );\n\n\t\t\t// If it is the last block, exit.\n\t\t\tif ( position === order.length - 1 ) {\n\t\t\t\tmoveBlocksToPosition(\n\t\t\t\t\t[ clientId ],\n\t\t\t\t\twrapperClientId,\n\t\t\t\t\tgetBlockRootClientId( wrapperClientId ),\n\t\t\t\t\tgetBlockIndex( wrapperClientId ) + 1\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If it is in the middle, split the block in two.\n\t\t\tconst wrapperBlock = getBlock( wrapperClientId );\n\t\t\tbatch( () => {\n\t\t\t\tduplicateBlocks( [ wrapperClientId ] );\n\t\t\t\tconst blockIndex = getBlockIndex( wrapperClientId );\n\n\t\t\t\treplaceInnerBlocks(\n\t\t\t\t\twrapperClientId,\n\t\t\t\t\twrapperBlock.innerBlocks.slice( 0, position )\n\t\t\t\t);\n\t\t\t\treplaceInnerBlocks(\n\t\t\t\t\tgetNextBlockClientId( wrapperClientId ),\n\t\t\t\t\twrapperBlock.innerBlocks.slice( position + 1 )\n\t\t\t\t);\n\t\t\t\tinsertBlock(\n\t\t\t\t\tcreateBlock( 'core/paragraph' ),\n\t\t\t\t\tblockIndex + 1,\n\t\t\t\t\tgetBlockRootClientId( wrapperClientId ),\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t} );\n\t\t}\n\n\t\telement.addEventListener( 'keydown', onKeyDown );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'keydown', onKeyDown );\n\t\t};\n\t}, [] );\n}\n"]}