{"version":3,"sources":["@wordpress/block-library/src/gallery/use-get-new-images.js"],"names":["useMemo","useState","useGetNewImages","images","imageData","currentImages","setCurrentImages","getNewImages","imagesUpdated","newCurrentImages","filter","currentImg","find","img","clientId","length","forEach","image","fromSavedContent","currentImage","id","push","newImages","fromSavedConent"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,OAAT,EAAkBC,QAAlB,QAAkC,oBAAlC;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,eAAe,SAASC,eAAT,CAA0BC,MAA1B,EAAkCC,SAAlC,EAA8C;AAC5D,QAAM,CAAEC,aAAF,EAAiBC,gBAAjB,IAAsCL,QAAQ,CAAE,EAAF,CAApD;AAEA,SAAOD,OAAO,CAAE,MAAMO,YAAY,EAApB,EAAwB,CAAEJ,MAAF,EAAUC,SAAV,CAAxB,CAAd;;AAEA,WAASG,YAAT,GAAwB;AACvB,QAAIC,aAAa,GAAG,KAApB,CADuB,CAGvB;;AACA,UAAMC,gBAAgB,GAAGJ,aAAa,CAACK,MAAd,CAAwBC,UAAF,IAC9CR,MAAM,CAACS,IAAP,CAAeC,GAAF,IAAW;AACvB,aAAOF,UAAU,CAACG,QAAX,KAAwBD,GAAG,CAACC,QAAnC;AACA,KAFD,CADwB,CAAzB;;AAMA,QAAKL,gBAAgB,CAACM,MAAjB,GAA0BV,aAAa,CAACU,MAA7C,EAAsD;AACrDP,MAAAA,aAAa,GAAG,IAAhB;AACA,KAZsB,CAcvB;AACA;;;AACAL,IAAAA,MAAM,CAACa,OAAP,CAAkBC,KAAF,IAAa;AAC5B,UACCA,KAAK,CAACC,gBAAN,IACA,CAAET,gBAAgB,CAACG,IAAjB,CACCO,YAAF,IAAoBA,YAAY,CAACC,EAAb,KAAoBH,KAAK,CAACG,EAD7C,CAFH,EAKE;AACDZ,QAAAA,aAAa,GAAG,IAAhB;AACAC,QAAAA,gBAAgB,CAACY,IAAjB,CAAuBJ,KAAvB;AACA;AACD,KAVD,EAhBuB,CA4BvB;AACA;;AACA,UAAMK,SAAS,GAAGnB,MAAM,CAACO,MAAP,CACfO,KAAF,IACC,CAAER,gBAAgB,CAACG,IAAjB,CACCO,YAAF,IACCF,KAAK,CAACH,QAAN,IACAK,YAAY,CAACL,QAAb,KAA0BG,KAAK,CAACH,QAHhC,CAAF,KAKAV,SALA,aAKAA,SALA,uBAKAA,SAAS,CAAEQ,IAAX,CAAmBC,GAAF,IAAWA,GAAG,CAACO,EAAJ,KAAWH,KAAK,CAACG,EAA7C,CALA,KAMA,CAAEH,KAAK,CAACM,eARQ,CAAlB;;AAWA,QAAKf,aAAa,IAAI,CAAAc,SAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAEP,MAAX,IAAoB,CAA1C,EAA8C;AAC7CT,MAAAA,gBAAgB,CAAE,CAAE,GAAGG,gBAAL,EAAuB,GAAGa,SAA1B,CAAF,CAAhB;AACA;;AAED,WAAOA,SAAS,CAACP,MAAV,GAAmB,CAAnB,GAAuBO,SAAvB,GAAmC,IAA1C;AACA;AACD","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useMemo, useState } from '@wordpress/element';\n\n/**\n * Keeps track of images already in the gallery to allow new innerBlocks to be identified. This\n * is required so default gallery attributes can be applied without overwriting any custom\n * attributes applied to existing images.\n *\n * @param {Array} images    Basic image block data taken from current gallery innerBlock\n * @param {Array} imageData The related image data for each of the current gallery images.\n *\n * @return {Array} An array of any new images that have been added to the gallery.\n */\nexport default function useGetNewImages( images, imageData ) {\n\tconst [ currentImages, setCurrentImages ] = useState( [] );\n\n\treturn useMemo( () => getNewImages(), [ images, imageData ] );\n\n\tfunction getNewImages() {\n\t\tlet imagesUpdated = false;\n\n\t\t// First lets check if any images have been deleted.\n\t\tconst newCurrentImages = currentImages.filter( ( currentImg ) =>\n\t\t\timages.find( ( img ) => {\n\t\t\t\treturn currentImg.clientId === img.clientId;\n\t\t\t} )\n\t\t);\n\n\t\tif ( newCurrentImages.length < currentImages.length ) {\n\t\t\timagesUpdated = true;\n\t\t}\n\n\t\t// Now lets see if we have any images hydrated from saved content and if so\n\t\t// add them to currentImages state.\n\t\timages.forEach( ( image ) => {\n\t\t\tif (\n\t\t\t\timage.fromSavedContent &&\n\t\t\t\t! newCurrentImages.find(\n\t\t\t\t\t( currentImage ) => currentImage.id === image.id\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\timagesUpdated = true;\n\t\t\t\tnewCurrentImages.push( image );\n\t\t\t}\n\t\t} );\n\n\t\t// Now check for any new images that have been added to InnerBlocks and for which\n\t\t// we have the imageData we need for setting default block attributes.\n\t\tconst newImages = images.filter(\n\t\t\t( image ) =>\n\t\t\t\t! newCurrentImages.find(\n\t\t\t\t\t( currentImage ) =>\n\t\t\t\t\t\timage.clientId &&\n\t\t\t\t\t\tcurrentImage.clientId === image.clientId\n\t\t\t\t) &&\n\t\t\t\timageData?.find( ( img ) => img.id === image.id ) &&\n\t\t\t\t! image.fromSavedConent\n\t\t);\n\n\t\tif ( imagesUpdated || newImages?.length > 0 ) {\n\t\t\tsetCurrentImages( [ ...newCurrentImages, ...newImages ] );\n\t\t}\n\n\t\treturn newImages.length > 0 ? newImages : null;\n\t}\n}\n"]}