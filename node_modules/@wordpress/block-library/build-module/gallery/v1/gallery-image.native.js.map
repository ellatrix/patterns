{"version":3,"sources":["@wordpress/block-library/src/gallery/v1/gallery-image.native.js"],"names":["StyleSheet","View","ScrollView","TouchableWithoutFeedback","isEmpty","requestImageFailedRetryDialog","requestImageUploadCancelDialog","requestImageFullscreenPreview","Component","Image","__","sprintf","Caption","MediaUploadProgress","getProtocol","withPreferredColorScheme","arrowLeft","arrowRight","warning","Button","style","compose","separatorStyle","separator","borderRightWidth","hairlineWidth","buttonStyle","button","aspectRatio","ICON_SIZE_ARROW","GalleryImage","constructor","arguments","onSelectImage","bind","onSelectCaption","onMediaPressed","onCaptionChange","onSelectMedia","updateMediaProgress","finishMediaUploadWithSuccess","finishMediaUploadWithFailure","renderContent","state","captionSelected","isUploadInProgress","didUploadFail","setState","props","isSelected","onSelect","id","url","isBlockSelected","onSelectBlock","media","setAttributes","caption","componentDidUpdate","prevProps","image","source_url","alt","alt_text","payload","mediaServerId","mediaUrl","params","isFirstItem","isLastItem","onRemove","onMoveForward","onMoveBackward","ariaLabel","isCropped","getStylesFromColorScheme","isRTL","isUploadFailed","retryMessage","resizeMode","captionPlaceholderStyle","captionPlaceholder","captionPlaceholderDark","shouldShowCaptionEditable","shouldShowCaptionExpanded","captionContainerStyle","captionExpandedContainer","captionContainer","captionStyle","captionExpanded","mediaPickerOptions","destructiveButton","label","onPress","separated","value","height","toolbarContainer","toolbar","moverButtonContainer","undefined","color","render","containerStyle","galleryImageContainer","galleryImageContainerDark","accessibilityLabelImageContainer"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tStyleSheet,\n\tView,\n\tScrollView,\n\tTouchableWithoutFeedback,\n} from 'react-native';\nimport { isEmpty } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport {\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n\trequestImageFullscreenPreview,\n} from '@wordpress/react-native-bridge';\nimport { Component } from '@wordpress/element';\nimport { Image } from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { Caption, MediaUploadProgress } from '@wordpress/block-editor';\nimport { getProtocol } from '@wordpress/url';\nimport { withPreferredColorScheme } from '@wordpress/compose';\nimport { arrowLeft, arrowRight, warning } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport Button from './gallery-button';\nimport style from './gallery-image-style.scss';\n\nconst { compose } = StyleSheet;\n\nconst separatorStyle = compose( style.separator, {\n\tborderRightWidth: StyleSheet.hairlineWidth,\n} );\nconst buttonStyle = compose( style.button, { aspectRatio: 1 } );\nconst ICON_SIZE_ARROW = 15;\n\nclass GalleryImage extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onSelectImage = this.onSelectImage.bind( this );\n\t\tthis.onSelectCaption = this.onSelectCaption.bind( this );\n\t\tthis.onMediaPressed = this.onMediaPressed.bind( this );\n\t\tthis.onCaptionChange = this.onCaptionChange.bind( this );\n\t\tthis.onSelectMedia = this.onSelectMedia.bind( this );\n\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.finishMediaUploadWithSuccess =\n\t\t\tthis.finishMediaUploadWithSuccess.bind( this );\n\t\tthis.finishMediaUploadWithFailure =\n\t\t\tthis.finishMediaUploadWithFailure.bind( this );\n\t\tthis.renderContent = this.renderContent.bind( this );\n\n\t\tthis.state = {\n\t\t\tcaptionSelected: false,\n\t\t\tisUploadInProgress: false,\n\t\t\tdidUploadFail: false,\n\t\t};\n\t}\n\n\tonSelectCaption() {\n\t\tif ( ! this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: true,\n\t\t\t} );\n\t\t}\n\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\t}\n\n\tonMediaPressed() {\n\t\tconst { id, url, isSelected } = this.props;\n\t\tconst { captionSelected, isUploadInProgress, didUploadFail } =\n\t\t\tthis.state;\n\n\t\tthis.onSelectImage();\n\n\t\tif ( isUploadInProgress ) {\n\t\t\trequestImageUploadCancelDialog( id );\n\t\t} else if (\n\t\t\tdidUploadFail ||\n\t\t\t( id && getProtocol( url ) === 'file:' )\n\t\t) {\n\t\t\trequestImageFailedRetryDialog( id );\n\t\t} else if ( isSelected && ! captionSelected ) {\n\t\t\trequestImageFullscreenPreview( url );\n\t\t}\n\t}\n\n\tonSelectImage() {\n\t\tif ( ! this.props.isBlockSelected ) {\n\t\t\tthis.props.onSelectBlock();\n\t\t}\n\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\n\t\tif ( this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonSelectMedia( media ) {\n\t\tconst { setAttributes } = this.props;\n\t\tsetAttributes( media );\n\t}\n\n\tonCaptionChange( caption ) {\n\t\tconst { setAttributes } = this.props;\n\t\tsetAttributes( { caption } );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { isSelected, image, url } = this.props;\n\t\tif ( image && ! url ) {\n\t\t\tthis.props.setAttributes( {\n\t\t\t\turl: image.source_url,\n\t\t\t\talt: image.alt_text,\n\t\t\t} );\n\t\t}\n\n\t\t// Unselect the caption so when the user selects other image and comeback\n\t\t// the caption is not immediately selected.\n\t\tif (\n\t\t\tthis.state.captionSelected &&\n\t\t\t! isSelected &&\n\t\t\tprevProps.isSelected\n\t\t) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tupdateMediaProgress() {\n\t\tif ( ! this.state.isUploadInProgress ) {\n\t\t\tthis.setState( { isUploadInProgress: true } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tthis.setState( {\n\t\t\tisUploadInProgress: false,\n\t\t\tdidUploadFail: false,\n\t\t} );\n\n\t\tthis.props.setAttributes( {\n\t\t\tid: payload.mediaServerId,\n\t\t\turl: payload.mediaUrl,\n\t\t} );\n\t}\n\n\tfinishMediaUploadWithFailure() {\n\t\tthis.setState( {\n\t\t\tisUploadInProgress: false,\n\t\t\tdidUploadFail: true,\n\t\t} );\n\t}\n\n\trenderContent( params ) {\n\t\tconst {\n\t\t\turl,\n\t\t\tisFirstItem,\n\t\t\tisLastItem,\n\t\t\tisSelected,\n\t\t\tcaption,\n\t\t\tonRemove,\n\t\t\tonMoveForward,\n\t\t\tonMoveBackward,\n\t\t\t'aria-label': ariaLabel,\n\t\t\tisCropped,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tisRTL,\n\t\t} = this.props;\n\n\t\tconst { isUploadInProgress, captionSelected } = this.state;\n\t\tconst { isUploadFailed, retryMessage } = params;\n\t\tconst resizeMode = isCropped ? 'cover' : 'contain';\n\n\t\tconst captionPlaceholderStyle = getStylesFromColorScheme(\n\t\t\tstyle.captionPlaceholder,\n\t\t\tstyle.captionPlaceholderDark\n\t\t);\n\n\t\tconst shouldShowCaptionEditable = ! isUploadFailed && isSelected;\n\t\tconst shouldShowCaptionExpanded =\n\t\t\t! isUploadFailed && ! isSelected && !! caption;\n\n\t\tconst captionContainerStyle = shouldShowCaptionExpanded\n\t\t\t? style.captionExpandedContainer\n\t\t\t: style.captionContainer;\n\n\t\tconst captionStyle = shouldShowCaptionExpanded\n\t\t\t? style.captionExpanded\n\t\t\t: style.caption;\n\n\t\tconst mediaPickerOptions = [\n\t\t\t{\n\t\t\t\tdestructiveButton: true,\n\t\t\t\tid: 'removeImage',\n\t\t\t\tlabel: __( 'Remove' ),\n\t\t\t\tonPress: onRemove,\n\t\t\t\tseparated: true,\n\t\t\t\tvalue: 'removeImage',\n\t\t\t},\n\t\t];\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<Image\n\t\t\t\t\talt={ ariaLabel }\n\t\t\t\t\theight={ style.image.height }\n\t\t\t\t\tisSelected={ isSelected }\n\t\t\t\t\tisUploadFailed={ isUploadFailed }\n\t\t\t\t\tisUploadInProgress={ isUploadInProgress }\n\t\t\t\t\tmediaPickerOptions={ mediaPickerOptions }\n\t\t\t\t\tonSelectMediaUploadOption={ this.onSelectMedia }\n\t\t\t\t\tresizeMode={ resizeMode }\n\t\t\t\t\turl={ url }\n\t\t\t\t\tretryMessage={ retryMessage }\n\t\t\t\t\tretryIcon={ warning }\n\t\t\t\t/>\n\n\t\t\t\t{ ! isUploadInProgress && isSelected && (\n\t\t\t\t\t<View style={ style.toolbarContainer }>\n\t\t\t\t\t\t<View style={ style.toolbar }>\n\t\t\t\t\t\t\t<View style={ style.moverButtonContainer }>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tstyle={ buttonStyle }\n\t\t\t\t\t\t\t\t\ticon={ isRTL ? arrowRight : arrowLeft }\n\t\t\t\t\t\t\t\t\ticonSize={ ICON_SIZE_ARROW }\n\t\t\t\t\t\t\t\t\tonClick={\n\t\t\t\t\t\t\t\t\t\tisFirstItem ? undefined : onMoveBackward\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\taccessibilityLabel={ __(\n\t\t\t\t\t\t\t\t\t\t'Move Image Backward'\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\taria-disabled={ isFirstItem }\n\t\t\t\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<View style={ separatorStyle } />\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tstyle={ buttonStyle }\n\t\t\t\t\t\t\t\t\ticon={ isRTL ? arrowLeft : arrowRight }\n\t\t\t\t\t\t\t\t\ticonSize={ ICON_SIZE_ARROW }\n\t\t\t\t\t\t\t\t\tonClick={\n\t\t\t\t\t\t\t\t\t\tisLastItem ? undefined : onMoveForward\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\taccessibilityLabel={ __(\n\t\t\t\t\t\t\t\t\t\t'Move Image Forward'\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\taria-disabled={ isLastItem }\n\t\t\t\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t</View>\n\t\t\t\t\t</View>\n\t\t\t\t) }\n\n\t\t\t\t{ ! isUploadInProgress &&\n\t\t\t\t\t( shouldShowCaptionEditable ||\n\t\t\t\t\t\tshouldShowCaptionExpanded ) && (\n\t\t\t\t\t\t<View style={ captionContainerStyle }>\n\t\t\t\t\t\t\t<ScrollView\n\t\t\t\t\t\t\t\tnestedScrollEnabled\n\t\t\t\t\t\t\t\tkeyboardShouldPersistTaps=\"handled\"\n\t\t\t\t\t\t\t\tbounces={ false }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Caption\n\t\t\t\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t\t\t\t\tisSelected={ isSelected && captionSelected }\n\t\t\t\t\t\t\t\t\tonChange={ this.onCaptionChange }\n\t\t\t\t\t\t\t\t\tonFocus={ this.onSelectCaption }\n\t\t\t\t\t\t\t\t\tplaceholder={\n\t\t\t\t\t\t\t\t\t\tisSelected ? __( 'Add caption' ) : null\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tplaceholderTextColor={\n\t\t\t\t\t\t\t\t\t\tcaptionPlaceholderStyle.color\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tstyle={ captionStyle }\n\t\t\t\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</ScrollView>\n\t\t\t\t\t\t</View>\n\t\t\t\t\t) }\n\t\t\t</>\n\t\t);\n\t}\n\n\trender() {\n\t\tconst { id, onRemove, getStylesFromColorScheme, isSelected } =\n\t\t\tthis.props;\n\n\t\tconst containerStyle = getStylesFromColorScheme(\n\t\t\tstyle.galleryImageContainer,\n\t\t\tstyle.galleryImageContainerDark\n\t\t);\n\n\t\treturn (\n\t\t\t<TouchableWithoutFeedback\n\t\t\t\tonPress={ this.onMediaPressed }\n\t\t\t\taccessible={ ! isSelected } // We need only child views to be accessible after the selection.\n\t\t\t\taccessibilityLabel={ this.accessibilityLabelImageContainer() } // if we don't set this explicitly it reads system provided accessibilityLabels of all child components and those include pretty technical words which don't make sense\n\t\t\t\taccessibilityRole={ 'imagebutton' } // this makes VoiceOver to read a description of image provided by system on iOS and lets user know this is a button which conveys the message of tappablity\n\t\t\t>\n\t\t\t\t<View style={ containerStyle }>\n\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\tonFinishMediaUploadWithSuccess={\n\t\t\t\t\t\t\tthis.finishMediaUploadWithSuccess\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonFinishMediaUploadWithFailure={\n\t\t\t\t\t\t\tthis.finishMediaUploadWithFailure\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonMediaUploadStateReset={ onRemove }\n\t\t\t\t\t\trenderContent={ this.renderContent }\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t</TouchableWithoutFeedback>\n\t\t);\n\t}\n\n\taccessibilityLabelImageContainer() {\n\t\tconst { caption, 'aria-label': ariaLabel } = this.props;\n\n\t\treturn isEmpty( caption )\n\t\t\t? ariaLabel\n\t\t\t: ariaLabel +\n\t\t\t\t\t'. ' +\n\t\t\t\t\tsprintf(\n\t\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\t\tcaption\n\t\t\t\t\t);\n\t}\n}\n\nexport default withPreferredColorScheme( GalleryImage );\n"]}