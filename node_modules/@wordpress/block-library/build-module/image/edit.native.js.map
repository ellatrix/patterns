{"version":3,"sources":["@wordpress/block-library/src/image/edit.native.js"],"names":["ActivityIndicator","Image","RNImage","TouchableWithoutFeedback","View","useRoute","Component","useEffect","requestMediaImport","mediaUploadSync","requestImageFailedRetryDialog","requestImageUploadCancelDialog","requestImageFullscreenPreview","setFeaturedImage","Icon","PanelBody","ToolbarButton","ToolbarGroup","WIDE_ALIGNMENTS","LinkSettingsNavigation","BottomSheet","BottomSheetTextControl","BottomSheetSelectControl","FooterMessageControl","FooterMessageLink","Badge","BlockCaption","MediaPlaceholder","MediaUpload","MediaUploadProgress","MEDIA_TYPE_IMAGE","BlockControls","InspectorControls","BlockAlignmentToolbar","BlockStyles","store","blockEditorStore","blockSettingsScreens","__","_x","sprintf","getProtocol","hasQueryArg","isURL","doAction","hasAction","compose","withPreferredColorScheme","withSelect","withDispatch","image","placeholderIcon","replace","fullscreen","textColor","coreStore","noticesStore","editPostStore","styles","getUpdatedLinkTargetSettings","LINK_DESTINATION_NONE","LINK_DESTINATION_CUSTOM","LINK_DESTINATION_ATTACHMENT","LINK_DESTINATION_MEDIA","MEDIA_ID_NO_FEATURED_IMAGE_SET","getUrlForSlug","sizeSlug","undefined","media_details","sizes","source_url","LinkSettings","attributes","isLinkSheetVisible","setMappedAttributes","route","href","url","label","linkDestination","linkTarget","rel","inputValue","newUrl","params","newLinkDestination","link","valueMask","linkSettingsOptions","autoFocus","autoFill","openInNewTab","linkRel","placeholder","navigation","navigate","imageLinkDestinations","imageUrl","attachmentPageUrl","UPLOAD_STATE_IDLE","UPLOAD_STATE_UPLOADING","UPLOAD_STATE_SUCCEEDED","UPLOAD_STATE_FAILED","ImageEdit","constructor","props","state","isCaptionSelected","uploadStatus","replacedFeaturedImage","finishMediaUploadWithSuccess","bind","finishMediaUploadWithFailure","mediaUploadStateReset","onSelectMediaUploadOption","updateMediaProgress","updateImageURL","onSetNewTab","onSetSizeSlug","onImagePressed","onSetFeatured","onFocusCaption","onSelectURL","updateAlignment","accessibilityLabelCreator","onSizeChangeValue","componentDidMount","setAttributes","id","console","warn","componentWillUnmount","componentDidUpdate","previousProps","featuredImageId","updatedUrl","previousId","canImageBeFeatured","getDerivedStateFromProps","isSelected","caption","trim","length","setState","payload","mediaUrl","mediaServerId","mediaId","width","height","nextAlign","extraUpdatedAttributes","Object","values","alignments","includes","align","value","updatedLinkTarget","media","imageDefaultSize","destination","mediaAttributes","alt","additionalAttributes","newURL","createErrorNotice","isFetchingImage","getSize","onFocus","getPlaceholderIcon","getStylesFromColorScheme","iconPlaceholder","iconPlaceholderDark","showLoadingIndicator","image__loading","getWidth","restAttributes","getAltTextSettings","updateAlt","newAlt","newValue","closeSettingsBottomSheet","getFeaturedButtonPanel","isFeaturedImage","setFeaturedButtonStyle","setFeaturedButton","setFeaturedButtonDark","removeFeaturedButton","setFeaturedButtonCellContainer","isGif","toLowerCase","render","clientId","context","wasBlockJustInserted","shouldUseFastImage","className","hasImageContext","keys","imageSizes","Array","isArray","sizeOptions","filter","slug","map","name","selectedSizeOption","sizeOptionsValid","find","option","getToolbarEditButton","open","getInspectorControls","panelBody","featuredImagePanelTitle","content","alignToFlex","left","center","right","full","wide","additionalImageProps","resizeMode","imageCrop","imageContainerStyles","fixedHeight","badgeLabelShown","badgeLabelText","getImageComponent","openMediaOptions","getMediaOptions","isUploadInProgress","isUploadFailed","retryMessage","onBlur","insertBlocksAfter","select","getMedia","getSettings","getEditedPostAttribute","capabilities","isNotFileUrl","shouldGetMedia","dispatch","closeGeneralSidebar"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tActivityIndicator,\n\tImage as RNImage,\n\tTouchableWithoutFeedback,\n\tView,\n} from 'react-native';\nimport { useRoute } from '@react-navigation/native';\n\n/**\n * WordPress dependencies\n */\nimport { Component, useEffect } from '@wordpress/element';\nimport {\n\trequestMediaImport,\n\tmediaUploadSync,\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n\trequestImageFullscreenPreview,\n\tsetFeaturedImage,\n} from '@wordpress/react-native-bridge';\nimport {\n\tIcon,\n\tPanelBody,\n\tToolbarButton,\n\tToolbarGroup,\n\tImage,\n\tWIDE_ALIGNMENTS,\n\tLinkSettingsNavigation,\n\tBottomSheet,\n\tBottomSheetTextControl,\n\tBottomSheetSelectControl,\n\tFooterMessageControl,\n\tFooterMessageLink,\n\tBadge,\n} from '@wordpress/components';\nimport {\n\tBlockCaption,\n\tMediaPlaceholder,\n\tMediaUpload,\n\tMediaUploadProgress,\n\tMEDIA_TYPE_IMAGE,\n\tBlockControls,\n\tInspectorControls,\n\tBlockAlignmentToolbar,\n\tBlockStyles,\n\tstore as blockEditorStore,\n\tblockSettingsScreens,\n} from '@wordpress/block-editor';\nimport { __, _x, sprintf } from '@wordpress/i18n';\nimport { getProtocol, hasQueryArg, isURL } from '@wordpress/url';\nimport { doAction, hasAction } from '@wordpress/hooks';\nimport { compose, withPreferredColorScheme } from '@wordpress/compose';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport {\n\timage as placeholderIcon,\n\treplace,\n\tfullscreen,\n\ttextColor,\n} from '@wordpress/icons';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { store as noticesStore } from '@wordpress/notices';\n// eslint-disable-next-line no-restricted-imports\nimport { store as editPostStore } from '@wordpress/edit-post';\n\n/**\n * Internal dependencies\n */\nimport styles from './styles.scss';\nimport { getUpdatedLinkTargetSettings } from './utils';\n\nimport {\n\tLINK_DESTINATION_NONE,\n\tLINK_DESTINATION_CUSTOM,\n\tLINK_DESTINATION_ATTACHMENT,\n\tLINK_DESTINATION_MEDIA,\n\tMEDIA_ID_NO_FEATURED_IMAGE_SET,\n} from './constants';\n\nconst getUrlForSlug = ( image, sizeSlug ) => {\n\tif ( ! sizeSlug ) {\n\t\treturn undefined;\n\t}\n\treturn image?.media_details?.sizes?.[ sizeSlug ]?.source_url;\n};\n\nfunction LinkSettings( {\n\tattributes,\n\timage,\n\tisLinkSheetVisible,\n\tsetMappedAttributes,\n} ) {\n\tconst route = useRoute();\n\tconst { href: url, label, linkDestination, linkTarget, rel } = attributes;\n\n\t// Persist attributes passed from child screen.\n\tuseEffect( () => {\n\t\tconst { inputValue: newUrl } = route.params || {};\n\n\t\tlet newLinkDestination;\n\t\tswitch ( newUrl ) {\n\t\t\tcase attributes.url:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_MEDIA;\n\t\t\t\tbreak;\n\t\t\tcase image?.link:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_ATTACHMENT;\n\t\t\t\tbreak;\n\t\t\tcase '':\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_NONE;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_CUSTOM;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tsetMappedAttributes( {\n\t\t\turl: newUrl,\n\t\t\tlinkDestination: newLinkDestination,\n\t\t} );\n\t}, [ route.params?.inputValue ] );\n\n\tlet valueMask;\n\tswitch ( linkDestination ) {\n\t\tcase LINK_DESTINATION_MEDIA:\n\t\t\tvalueMask = __( 'Media File' );\n\t\t\tbreak;\n\t\tcase LINK_DESTINATION_ATTACHMENT:\n\t\t\tvalueMask = __( 'Attachment Page' );\n\t\t\tbreak;\n\t\tcase LINK_DESTINATION_CUSTOM:\n\t\t\tvalueMask = __( 'Custom URL' );\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tvalueMask = __( 'None' );\n\t\t\tbreak;\n\t}\n\n\tconst linkSettingsOptions = {\n\t\turl: {\n\t\t\tvalueMask,\n\t\t\tautoFocus: false,\n\t\t\tautoFill: false,\n\t\t},\n\t\topenInNewTab: {\n\t\t\tlabel: __( 'Open in new tab' ),\n\t\t},\n\t\tlinkRel: {\n\t\t\tlabel: __( 'Link Rel' ),\n\t\t\tplaceholder: _x( 'None', 'Link rel attribute value placeholder' ),\n\t\t},\n\t};\n\n\treturn (\n\t\t<PanelBody title={ __( 'Link Settings' ) }>\n\t\t\t<LinkSettingsNavigation\n\t\t\t\tisVisible={ isLinkSheetVisible }\n\t\t\t\turl={ url }\n\t\t\t\trel={ rel }\n\t\t\t\tlabel={ label }\n\t\t\t\tlinkTarget={ linkTarget }\n\t\t\t\tsetAttributes={ setMappedAttributes }\n\t\t\t\twithBottomSheet={ false }\n\t\t\t\thasPicker\n\t\t\t\toptions={ linkSettingsOptions }\n\t\t\t\tshowIcon={ false }\n\t\t\t\tonLinkCellPressed={ ( { navigation } ) => {\n\t\t\t\t\tnavigation.navigate(\n\t\t\t\t\t\tblockSettingsScreens.imageLinkDestinations,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinputValue: attributes.href,\n\t\t\t\t\t\t\tlinkDestination: attributes.linkDestination,\n\t\t\t\t\t\t\timageUrl: attributes.url,\n\t\t\t\t\t\t\tattachmentPageUrl: image?.link,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} }\n\t\t\t/>\n\t\t</PanelBody>\n\t);\n}\n\nconst UPLOAD_STATE_IDLE = 0;\nconst UPLOAD_STATE_UPLOADING = 1;\nconst UPLOAD_STATE_SUCCEEDED = 2;\nconst UPLOAD_STATE_FAILED = 3;\n\nexport class ImageEdit extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tisCaptionSelected: false,\n\t\t\tuploadStatus: UPLOAD_STATE_IDLE,\n\t\t};\n\n\t\tthis.replacedFeaturedImage = false;\n\n\t\tthis.finishMediaUploadWithSuccess =\n\t\t\tthis.finishMediaUploadWithSuccess.bind( this );\n\t\tthis.finishMediaUploadWithFailure =\n\t\t\tthis.finishMediaUploadWithFailure.bind( this );\n\t\tthis.mediaUploadStateReset = this.mediaUploadStateReset.bind( this );\n\t\tthis.onSelectMediaUploadOption =\n\t\t\tthis.onSelectMediaUploadOption.bind( this );\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.updateImageURL = this.updateImageURL.bind( this );\n\t\tthis.onSetNewTab = this.onSetNewTab.bind( this );\n\t\tthis.onSetSizeSlug = this.onSetSizeSlug.bind( this );\n\t\tthis.onImagePressed = this.onImagePressed.bind( this );\n\t\tthis.onSetFeatured = this.onSetFeatured.bind( this );\n\t\tthis.onFocusCaption = this.onFocusCaption.bind( this );\n\t\tthis.onSelectURL = this.onSelectURL.bind( this );\n\t\tthis.updateAlignment = this.updateAlignment.bind( this );\n\t\tthis.accessibilityLabelCreator =\n\t\t\tthis.accessibilityLabelCreator.bind( this );\n\t\tthis.setMappedAttributes = this.setMappedAttributes.bind( this );\n\t\tthis.onSizeChangeValue = this.onSizeChangeValue.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, setAttributes } = this.props;\n\t\t// This will warn when we have `id` defined, while `url` is undefined.\n\t\t// This may help track this issue: https://github.com/wordpress-mobile/WordPress-Android/issues/9768\n\t\t// where a cancelled image upload was resulting in a subsequent crash.\n\t\tif ( attributes.id && ! attributes.url ) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn( 'Attributes has id with no url.' );\n\t\t}\n\n\t\t// Detect any pasted image and start an upload.\n\t\tif (\n\t\t\t! attributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestMediaImport( attributes.url, ( id, url ) => {\n\t\t\t\tif ( url ) {\n\t\t\t\t\tsetAttributes( { id, url } );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t// Make sure we mark any temporary images as failed if they failed while\n\t\t// the editor wasn't open.\n\t\tif (\n\t\t\tattributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\tmediaUploadSync();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\t// This action will only exist if the user pressed the trash button on the block holder.\n\t\tif (\n\t\t\thasAction( 'blocks.onRemoveBlockCheckUpload' ) &&\n\t\t\tthis.state.uploadStatus === UPLOAD_STATE_UPLOADING\n\t\t) {\n\t\t\tdoAction(\n\t\t\t\t'blocks.onRemoveBlockCheckUpload',\n\t\t\t\tthis.props.attributes.id\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentDidUpdate( previousProps ) {\n\t\tconst { image, attributes, setAttributes, featuredImageId } =\n\t\t\tthis.props;\n\t\tconst { url } = attributes;\n\t\tif ( ! previousProps.image && image ) {\n\t\t\tif ( ! hasQueryArg( url, 'w' ) && attributes?.sizeSlug ) {\n\t\t\t\tconst updatedUrl =\n\t\t\t\t\tgetUrlForSlug( image, attributes.sizeSlug ) ||\n\t\t\t\t\timage.source_url;\n\n\t\t\t\tsetAttributes( { url: updatedUrl } );\n\t\t\t}\n\t\t}\n\n\t\tconst { id } = attributes;\n\t\tconst { id: previousId } = previousProps.attributes;\n\n\t\t// The media changed and the previous media was set as the Featured Image,\n\t\t// we must keep track of the previous media's featured status to act on it\n\t\t// once the new media has a finalized ID.\n\t\tif (\n\t\t\t!! id &&\n\t\t\tid !== previousId &&\n\t\t\t!! featuredImageId &&\n\t\t\tfeaturedImageId === previousId\n\t\t) {\n\t\t\tthis.replacedFeaturedImage = true;\n\t\t}\n\n\t\t// The media changed and now has a finalized ID (e.g. upload completed), we\n\t\t// should attempt to replace the featured image if applicable.\n\t\tif (\n\t\t\tthis.replacedFeaturedImage &&\n\t\t\t!! image &&\n\t\t\tthis.canImageBeFeatured()\n\t\t) {\n\t\t\tthis.replacedFeaturedImage = false;\n\t\t\tsetFeaturedImage( id );\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\t// Avoid a UI flicker in the toolbar by insuring that isCaptionSelected\n\t\t// is updated immediately any time the isSelected prop becomes false.\n\t\treturn {\n\t\t\tisCaptionSelected: props.isSelected && state.isCaptionSelected,\n\t\t};\n\t}\n\n\taccessibilityLabelCreator( caption ) {\n\t\t// Checks if caption is empty.\n\t\treturn ( typeof caption === 'string' && caption.trim().length === 0 ) ||\n\t\t\tcaption === undefined ||\n\t\t\tcaption === null\n\t\t\t? /* translators: accessibility text. Empty image caption. */\n\t\t\t  'Image caption. Empty'\n\t\t\t: sprintf(\n\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\tcaption\n\t\t\t  );\n\t}\n\n\tonImagePressed() {\n\t\tconst { attributes, image } = this.props;\n\n\t\tif ( this.state.uploadStatus === UPLOAD_STATE_UPLOADING ) {\n\t\t\trequestImageUploadCancelDialog( attributes.id );\n\t\t} else if (\n\t\t\tattributes.id &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestImageFailedRetryDialog( attributes.id );\n\t\t} else if ( ! this.state.isCaptionSelected ) {\n\t\t\trequestImageFullscreenPreview(\n\t\t\t\tattributes.url,\n\t\t\t\timage && image.source_url\n\t\t\t);\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisCaptionSelected: false,\n\t\t} );\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( payload.mediaUrl ) {\n\t\t\tsetAttributes( { url: payload.mediaUrl } );\n\t\t}\n\n\t\tif ( this.state.uploadStatus !== UPLOAD_STATE_UPLOADING ) {\n\t\t\tthis.setState( { uploadStatus: UPLOAD_STATE_UPLOADING } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { url: payload.mediaUrl, id: payload.mediaServerId } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_SUCCEEDED } );\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: payload.mediaId } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_FAILED } );\n\t}\n\n\tmediaUploadStateReset() {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: null, url: null } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_IDLE } );\n\t}\n\n\tupdateImageURL( url ) {\n\t\tthis.props.setAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t} );\n\t}\n\n\tupdateAlignment( nextAlign ) {\n\t\tconst extraUpdatedAttributes = Object.values(\n\t\t\tWIDE_ALIGNMENTS.alignments\n\t\t).includes( nextAlign )\n\t\t\t? { width: undefined, height: undefined }\n\t\t\t: {};\n\t\tthis.props.setAttributes( {\n\t\t\t...extraUpdatedAttributes,\n\t\t\talign: nextAlign,\n\t\t} );\n\t}\n\n\tonSetNewTab( value ) {\n\t\tconst updatedLinkTarget = getUpdatedLinkTargetSettings(\n\t\t\tvalue,\n\t\t\tthis.props.attributes\n\t\t);\n\t\tthis.props.setAttributes( updatedLinkTarget );\n\t}\n\n\tonSetSizeSlug( sizeSlug ) {\n\t\tconst { image, setAttributes } = this.props;\n\n\t\tconst url = getUrlForSlug( image, sizeSlug );\n\t\tif ( ! url ) {\n\t\t\treturn null;\n\t\t}\n\t\tsetAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tsizeSlug,\n\t\t} );\n\t}\n\n\tonSelectMediaUploadOption( media ) {\n\t\tconst { imageDefaultSize } = this.props;\n\t\tconst { id, url, destination } = this.props.attributes;\n\t\tconst mediaAttributes = {\n\t\t\tid: media.id,\n\t\t\turl: media.url,\n\t\t\tcaption: media.caption,\n\t\t\talt: media.alt,\n\t\t};\n\n\t\tlet additionalAttributes;\n\t\t// Reset the dimension attributes if changing to a different image.\n\t\tif ( ! media.id || media.id !== id ) {\n\t\t\tadditionalAttributes = {\n\t\t\t\twidth: undefined,\n\t\t\t\theight: undefined,\n\t\t\t\tsizeSlug: imageDefaultSize,\n\t\t\t};\n\t\t} else {\n\t\t\t// Keep the same url when selecting the same file, so \"Image Size\" option is not changed.\n\t\t\tadditionalAttributes = { url };\n\t\t}\n\n\t\tlet href;\n\t\tswitch ( destination ) {\n\t\t\tcase LINK_DESTINATION_MEDIA:\n\t\t\t\thref = media.url;\n\t\t\t\tbreak;\n\t\t\tcase LINK_DESTINATION_ATTACHMENT:\n\t\t\t\thref = media.link;\n\t\t\t\tbreak;\n\t\t}\n\t\tmediaAttributes.href = href;\n\n\t\tthis.props.setAttributes( {\n\t\t\t...mediaAttributes,\n\t\t\t...additionalAttributes,\n\t\t} );\n\t}\n\n\tonSelectURL( newURL ) {\n\t\tconst { createErrorNotice, imageDefaultSize, setAttributes } =\n\t\t\tthis.props;\n\n\t\tif ( isURL( newURL ) ) {\n\t\t\tthis.setState( {\n\t\t\t\tisFetchingImage: true,\n\t\t\t} );\n\n\t\t\t// Use RN's Image.getSize to determine if URL is a valid image\n\t\t\tRNImage.getSize(\n\t\t\t\tnewURL,\n\t\t\t\t() => {\n\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\turl: newURL,\n\t\t\t\t\t\tid: undefined,\n\t\t\t\t\t\twidth: undefined,\n\t\t\t\t\t\theight: undefined,\n\t\t\t\t\t\tsizeSlug: imageDefaultSize,\n\t\t\t\t\t} );\n\t\t\t\t\tthis.setState( {\n\t\t\t\t\t\tisFetchingImage: false,\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\tcreateErrorNotice( __( 'Image file not found.' ) );\n\t\t\t\t\tthis.setState( {\n\t\t\t\t\t\tisFetchingImage: false,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\tcreateErrorNotice( __( 'Invalid URL.' ) );\n\t\t}\n\t}\n\n\tonFocusCaption() {\n\t\tif ( this.props.onFocus ) {\n\t\t\tthis.props.onFocus();\n\t\t}\n\t\tif ( ! this.state.isCaptionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tisCaptionSelected: true,\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetPlaceholderIcon() {\n\t\treturn (\n\t\t\t<Icon\n\t\t\t\ticon={ placeholderIcon }\n\t\t\t\t{ ...this.props.getStylesFromColorScheme(\n\t\t\t\t\tstyles.iconPlaceholder,\n\t\t\t\t\tstyles.iconPlaceholderDark\n\t\t\t\t) }\n\t\t\t/>\n\t\t);\n\t}\n\n\tshowLoadingIndicator() {\n\t\treturn (\n\t\t\t<View style={ styles.image__loading }>\n\t\t\t\t<ActivityIndicator animating />\n\t\t\t</View>\n\t\t);\n\t}\n\n\tgetWidth() {\n\t\tconst { attributes } = this.props;\n\t\tconst { align, width } = attributes;\n\n\t\treturn Object.values( WIDE_ALIGNMENTS.alignments ).includes( align )\n\t\t\t? '100%'\n\t\t\t: width;\n\t}\n\n\tsetMappedAttributes( { url: href, linkDestination, ...restAttributes } ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( ! href && ! linkDestination ) {\n\t\t\tlinkDestination = LINK_DESTINATION_NONE;\n\t\t} else if ( ! linkDestination ) {\n\t\t\tlinkDestination = LINK_DESTINATION_CUSTOM;\n\t\t}\n\n\t\treturn href === undefined || href === this.props.attributes.href\n\t\t\t? setAttributes( restAttributes )\n\t\t\t: setAttributes( {\n\t\t\t\t\t...restAttributes,\n\t\t\t\t\tlinkDestination,\n\t\t\t\t\thref,\n\t\t\t  } );\n\t}\n\n\tgetAltTextSettings() {\n\t\tconst {\n\t\t\tattributes: { alt },\n\t\t} = this.props;\n\n\t\tconst updateAlt = ( newAlt ) => {\n\t\t\tthis.props.setAttributes( { alt: newAlt } );\n\t\t};\n\n\t\treturn (\n\t\t\t<BottomSheetTextControl\n\t\t\t\tinitialValue={ alt }\n\t\t\t\tonChange={ updateAlt }\n\t\t\t\tplaceholder={ __( 'Add alt text' ) }\n\t\t\t\tlabel={ __( 'Alt Text' ) }\n\t\t\t\ticon={ textColor }\n\t\t\t\tfooterNote={\n\t\t\t\t\t<>\n\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t'Describe the purpose of the image. Leave empty if the image is purely decorative.'\n\t\t\t\t\t\t) }{ ' ' }\n\t\t\t\t\t\t<FooterMessageLink\n\t\t\t\t\t\t\thref={\n\t\t\t\t\t\t\t\t'https://www.w3.org/WAI/tutorials/images/decision-tree/'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue={ __( 'What is alt text?' ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\t}\n\n\tonSizeChangeValue( newValue ) {\n\t\tthis.onSetSizeSlug( newValue );\n\t}\n\n\tonSetFeatured( mediaId ) {\n\t\tconst { closeSettingsBottomSheet } = this.props;\n\t\tsetFeaturedImage( mediaId );\n\t\tcloseSettingsBottomSheet();\n\t}\n\n\tgetFeaturedButtonPanel( isFeaturedImage ) {\n\t\tconst { attributes, getStylesFromColorScheme } = this.props;\n\n\t\tconst setFeaturedButtonStyle = getStylesFromColorScheme(\n\t\t\tstyles.setFeaturedButton,\n\t\t\tstyles.setFeaturedButtonDark\n\t\t);\n\n\t\tconst removeFeaturedButton = () => (\n\t\t\t<BottomSheet.Cell\n\t\t\t\tlabel={ __( 'Remove as Featured Image' ) }\n\t\t\t\tlabelStyle={ [\n\t\t\t\t\tsetFeaturedButtonStyle,\n\t\t\t\t\tstyles.removeFeaturedButton,\n\t\t\t\t] }\n\t\t\t\tcellContainerStyle={ styles.setFeaturedButtonCellContainer }\n\t\t\t\tseparatorType={ 'none' }\n\t\t\t\tonPress={ () =>\n\t\t\t\t\tthis.onSetFeatured( MEDIA_ID_NO_FEATURED_IMAGE_SET )\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\n\t\tconst setFeaturedButton = () => (\n\t\t\t<BottomSheet.Cell\n\t\t\t\tlabel={ __( 'Set as Featured Image' ) }\n\t\t\t\tlabelStyle={ setFeaturedButtonStyle }\n\t\t\t\tcellContainerStyle={ styles.setFeaturedButtonCellContainer }\n\t\t\t\tseparatorType={ 'none' }\n\t\t\t\tonPress={ () => this.onSetFeatured( attributes.id ) }\n\t\t\t/>\n\t\t);\n\n\t\treturn isFeaturedImage ? removeFeaturedButton() : setFeaturedButton();\n\t}\n\n\t/**\n\t * Featured images must be set to a successfully uploaded self-hosted image,\n\t * which has an ID.\n\t *\n\t * @return {boolean} Boolean indicating whether or not the current may be set as featured.\n\t */\n\tcanImageBeFeatured() {\n\t\tconst {\n\t\t\tattributes: { id },\n\t\t} = this.props;\n\t\treturn (\n\t\t\ttypeof id !== 'undefined' &&\n\t\t\tthis.state.uploadStatus !== UPLOAD_STATE_UPLOADING &&\n\t\t\tthis.state.uploadStatus !== UPLOAD_STATE_FAILED\n\t\t);\n\t}\n\n\tisGif( url ) {\n\t\treturn url.toLowerCase().includes( '.gif' );\n\t}\n\n\trender() {\n\t\tconst { isCaptionSelected, isFetchingImage } = this.state;\n\t\tconst {\n\t\t\tattributes,\n\t\t\tisSelected,\n\t\t\timage,\n\t\t\tclientId,\n\t\t\timageDefaultSize,\n\t\t\tcontext,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted,\n\t\t\tshouldUseFastImage,\n\t\t} = this.props;\n\t\tconst { align, url, alt, id, sizeSlug, className } = attributes;\n\t\tconst hasImageContext = context\n\t\t\t? Object.keys( context ).length > 0\n\t\t\t: false;\n\n\t\tconst imageSizes = Array.isArray( this.props.imageSizes )\n\t\t\t? this.props.imageSizes\n\t\t\t: [];\n\t\t// Only map available image sizes for the user to choose.\n\t\tconst sizeOptions = imageSizes\n\t\t\t.filter( ( { slug } ) => getUrlForSlug( image, slug ) )\n\t\t\t.map( ( { name, slug } ) => ( { value: slug, label: name } ) );\n\n\t\tlet selectedSizeOption = sizeSlug || imageDefaultSize;\n\t\tlet sizeOptionsValid = sizeOptions.find(\n\t\t\t( option ) => option.value === selectedSizeOption\n\t\t);\n\n\t\tif ( ! sizeOptionsValid ) {\n\t\t\t// Default to 'full' size if the default large size is not available.\n\t\t\tsizeOptionsValid = sizeOptions.find(\n\t\t\t\t( option ) => option.value === 'full'\n\t\t\t);\n\t\t\tselectedSizeOption = 'full';\n\t\t}\n\n\t\tconst canImageBeFeatured = this.canImageBeFeatured();\n\t\tconst isFeaturedImage =\n\t\t\tcanImageBeFeatured && featuredImageId === attributes.id;\n\n\t\tconst getToolbarEditButton = ( open ) => (\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\ttitle={ __( 'Edit image' ) }\n\t\t\t\t\t\ticon={ replace }\n\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t\t<BlockAlignmentToolbar\n\t\t\t\t\tvalue={ align }\n\t\t\t\t\tonChange={ this.updateAlignment }\n\t\t\t\t/>\n\t\t\t</BlockControls>\n\t\t);\n\n\t\tconst getInspectorControls = () => (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Settings' ) } />\n\t\t\t\t<PanelBody style={ styles.panelBody }>\n\t\t\t\t\t<BlockStyles clientId={ clientId } url={ url } />\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody>\n\t\t\t\t\t{ image && sizeOptionsValid && (\n\t\t\t\t\t\t<BottomSheetSelectControl\n\t\t\t\t\t\t\ticon={ fullscreen }\n\t\t\t\t\t\t\tlabel={ __( 'Size' ) }\n\t\t\t\t\t\t\toptions={ sizeOptions }\n\t\t\t\t\t\t\tonChange={ this.onSizeChangeValue }\n\t\t\t\t\t\t\tvalue={ selectedSizeOption }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ this.getAltTextSettings() }\n\t\t\t\t</PanelBody>\n\t\t\t\t<LinkSettings\n\t\t\t\t\tattributes={ this.props.attributes }\n\t\t\t\t\timage={ this.props.image }\n\t\t\t\t\tisLinkSheetVisible={ this.state.isLinkSheetVisible }\n\t\t\t\t\tsetMappedAttributes={ this.setMappedAttributes }\n\t\t\t\t/>\n\t\t\t\t<PanelBody\n\t\t\t\t\ttitle={ __( 'Featured Image' ) }\n\t\t\t\t\ttitleStyle={ styles.featuredImagePanelTitle }\n\t\t\t\t>\n\t\t\t\t\t{ canImageBeFeatured &&\n\t\t\t\t\t\tthis.getFeaturedButtonPanel( isFeaturedImage ) }\n\t\t\t\t\t<FooterMessageControl\n\t\t\t\t\t\tlabel={ __(\n\t\t\t\t\t\t\t'Changes to featured image will not be affected by the undo/redo buttons.'\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tcellContainerStyle={\n\t\t\t\t\t\t\tstyles.setFeaturedButtonCellContainer\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t);\n\n\t\tif ( ! url ) {\n\t\t\treturn (\n\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t{ isFetchingImage && this.showLoadingIndicator() }\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\t\t\ticon={ this.getPlaceholderIcon() }\n\t\t\t\t\t\tonFocus={ this.props.onFocus }\n\t\t\t\t\t\tautoOpenMediaUpload={\n\t\t\t\t\t\t\tisSelected && wasBlockJustInserted\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t);\n\t\t}\n\n\t\tconst alignToFlex = {\n\t\t\tleft: 'flex-start',\n\t\t\tcenter: 'center',\n\t\t\tright: 'flex-end',\n\t\t\tfull: 'center',\n\t\t\twide: 'center',\n\t\t};\n\n\t\tconst additionalImageProps = {\n\t\t\theight: '100%',\n\t\t\tresizeMode: context?.imageCrop ? 'cover' : 'contain',\n\t\t};\n\n\t\tconst imageContainerStyles = [\n\t\t\tcontext?.fixedHeight && styles.fixedHeight,\n\t\t];\n\n\t\tconst isGif = this.isGif( url );\n\t\tconst badgeLabelShown = isFeaturedImage || isGif;\n\t\tlet badgeLabelText = '';\n\t\tif ( isFeaturedImage ) {\n\t\t\tbadgeLabelText = __( 'Featured' );\n\t\t} else if ( isGif ) {\n\t\t\tbadgeLabelText = __( 'GIF' );\n\t\t}\n\n\t\tconst getImageComponent = ( openMediaOptions, getMediaOptions ) => (\n\t\t\t<Badge label={ badgeLabelText } show={ badgeLabelShown }>\n\t\t\t\t<TouchableWithoutFeedback\n\t\t\t\t\taccessible={ ! isSelected }\n\t\t\t\t\tonPress={ this.onImagePressed }\n\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t>\n\t\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t\t{ isSelected && getInspectorControls() }\n\t\t\t\t\t\t{ isSelected && getMediaOptions() }\n\t\t\t\t\t\t{ ! this.state.isCaptionSelected &&\n\t\t\t\t\t\t\tgetToolbarEditButton( openMediaOptions ) }\n\t\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\t\tcoverUrl={ url }\n\t\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\t\tonFinishMediaUploadWithSuccess={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithSuccess\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonFinishMediaUploadWithFailure={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithFailure\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonMediaUploadStateReset={\n\t\t\t\t\t\t\t\tthis.mediaUploadStateReset\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trenderContent={ ( {\n\t\t\t\t\t\t\t\tisUploadInProgress,\n\t\t\t\t\t\t\t\tisUploadFailed,\n\t\t\t\t\t\t\t\tretryMessage,\n\t\t\t\t\t\t\t} ) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<View style={ imageContainerStyles }>\n\t\t\t\t\t\t\t\t\t\t{ isFetchingImage &&\n\t\t\t\t\t\t\t\t\t\t\tthis.showLoadingIndicator() }\n\t\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\t\talign={\n\t\t\t\t\t\t\t\t\t\t\t\talign && alignToFlex[ align ]\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\talt={ alt }\n\t\t\t\t\t\t\t\t\t\t\tisSelected={\n\t\t\t\t\t\t\t\t\t\t\t\tisSelected &&\n\t\t\t\t\t\t\t\t\t\t\t\t! isCaptionSelected\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tisUploadFailed={ isUploadFailed }\n\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress={\n\t\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tshouldUseFastImage={\n\t\t\t\t\t\t\t\t\t\t\t\tshouldUseFastImage\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tonSelectMediaUploadOption={\n\t\t\t\t\t\t\t\t\t\t\t\tthis.onSelectMediaUploadOption\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\topenMediaOptions={\n\t\t\t\t\t\t\t\t\t\t\t\topenMediaOptions\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tretryMessage={ retryMessage }\n\t\t\t\t\t\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\t\t\t\t\t\tshapeStyle={\n\t\t\t\t\t\t\t\t\t\t\t\tstyles[ className ] || className\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\twidth={ this.getWidth() }\n\t\t\t\t\t\t\t\t\t\t\t{ ...( hasImageContext\n\t\t\t\t\t\t\t\t\t\t\t\t? additionalImageProps\n\t\t\t\t\t\t\t\t\t\t\t\t: {} ) }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t</TouchableWithoutFeedback>\n\t\t\t\t<BlockCaption\n\t\t\t\t\tclientId={ this.props.clientId }\n\t\t\t\t\tisSelected={ this.state.isCaptionSelected }\n\t\t\t\t\taccessible={ ! this.state.isCaptionSelected }\n\t\t\t\t\taccessibilityLabelCreator={ this.accessibilityLabelCreator }\n\t\t\t\t\tonFocus={ this.onFocusCaption }\n\t\t\t\t\tonBlur={ this.props.onBlur } // Always assign onBlur as props.\n\t\t\t\t\tinsertBlocksAfter={ this.props.insertBlocksAfter }\n\t\t\t\t/>\n\t\t\t</Badge>\n\t\t);\n\n\t\treturn (\n\t\t\t<MediaUpload\n\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\tisReplacingMedia={ true }\n\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\trender={ ( { open, getMediaOptions } ) => {\n\t\t\t\t\treturn getImageComponent( open, getMediaOptions );\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, props ) => {\n\t\tconst { getMedia } = select( coreStore );\n\t\tconst { getSettings, wasBlockJustInserted } =\n\t\t\tselect( blockEditorStore );\n\t\tconst { getEditedPostAttribute } = select( 'core/editor' );\n\t\tconst {\n\t\t\tattributes: { id, url },\n\t\t\tisSelected,\n\t\t\tclientId,\n\t\t} = props;\n\t\tconst { imageSizes, imageDefaultSize, capabilities } = getSettings();\n\t\tconst isNotFileUrl = id && getProtocol( url ) !== 'file:';\n\t\tconst featuredImageId = getEditedPostAttribute( 'featured_media' );\n\n\t\tconst shouldGetMedia =\n\t\t\t( isSelected && isNotFileUrl ) ||\n\t\t\t// Edge case to update the image after uploading if the block gets unselected\n\t\t\t// Check if it's the original image and not the resized one with queryparams.\n\t\t\t( ! isSelected &&\n\t\t\t\tisNotFileUrl &&\n\t\t\t\turl &&\n\t\t\t\t! hasQueryArg( url, 'w' ) );\n\t\tconst image = shouldGetMedia ? getMedia( id ) : null;\n\n\t\treturn {\n\t\t\timage,\n\t\t\timageSizes,\n\t\t\timageDefaultSize,\n\t\t\tshouldUseFastImage: capabilities?.shouldUseFastImage === true,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted: wasBlockJustInserted(\n\t\t\t\tclientId,\n\t\t\t\t'inserter_menu'\n\t\t\t),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { createErrorNotice } = dispatch( noticesStore );\n\n\t\treturn {\n\t\t\tcreateErrorNotice,\n\t\t\tcloseSettingsBottomSheet() {\n\t\t\t\tdispatch( editPostStore ).closeGeneralSidebar();\n\t\t\t},\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n] )( ImageEdit );\n"]}