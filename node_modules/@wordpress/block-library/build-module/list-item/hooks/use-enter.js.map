{"version":3,"sources":["@wordpress/block-library/src/list-item/hooks/use-enter.js"],"names":["createBlock","getDefaultBlockName","cloneBlock","useRef","useRefEffect","ENTER","useSelect","useDispatch","store","blockEditorStore","useOutdentListItem","useEnter","props","replaceBlocks","selectionChange","getBlock","getBlockRootClientId","getBlockIndex","propsRef","current","canOutdent","outdentListItem","clientId","element","onKeyDown","event","defaultPrevented","keyCode","content","length","preventDefault","topParentListBlock","blockIndex","head","innerBlocks","slice","middle","after","tail","addEventListener","removeEventListener"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport {\n\tcreateBlock,\n\tgetDefaultBlockName,\n\tcloneBlock,\n} from '@wordpress/blocks';\nimport { useRef } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\nimport { ENTER } from '@wordpress/keycodes';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport useOutdentListItem from './use-outdent-list-item';\n\nexport default function useEnter( props ) {\n\tconst { replaceBlocks, selectionChange } = useDispatch( blockEditorStore );\n\tconst { getBlock, getBlockRootClientId, getBlockIndex } =\n\t\tuseSelect( blockEditorStore );\n\tconst propsRef = useRef( props );\n\tpropsRef.current = props;\n\tconst [ canOutdent, outdentListItem ] = useOutdentListItem(\n\t\tpropsRef.current.clientId\n\t);\n\treturn useRefEffect(\n\t\t( element ) => {\n\t\t\tfunction onKeyDown( event ) {\n\t\t\t\tif ( event.defaultPrevented || event.keyCode !== ENTER ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst { content, clientId } = propsRef.current;\n\t\t\t\tif ( content.length ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif ( canOutdent ) {\n\t\t\t\t\toutdentListItem();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Here we are in top level list so we need to split.\n\t\t\t\tconst topParentListBlock = getBlock(\n\t\t\t\t\tgetBlockRootClientId( clientId )\n\t\t\t\t);\n\t\t\t\tconst blockIndex = getBlockIndex( clientId );\n\t\t\t\tconst head = cloneBlock( {\n\t\t\t\t\t...topParentListBlock,\n\t\t\t\t\tinnerBlocks: topParentListBlock.innerBlocks.slice(\n\t\t\t\t\t\t0,\n\t\t\t\t\t\tblockIndex\n\t\t\t\t\t),\n\t\t\t\t} );\n\t\t\t\tconst middle = createBlock( getDefaultBlockName() );\n\t\t\t\t// Last list item might contain a `list` block innerBlock\n\t\t\t\t// In that case append remaining innerBlocks blocks.\n\t\t\t\tconst after = [\n\t\t\t\t\t...( topParentListBlock.innerBlocks[ blockIndex ]\n\t\t\t\t\t\t.innerBlocks[ 0 ]?.innerBlocks || [] ),\n\t\t\t\t\t...topParentListBlock.innerBlocks.slice( blockIndex + 1 ),\n\t\t\t\t];\n\t\t\t\tconst tail = after.length\n\t\t\t\t\t? [\n\t\t\t\t\t\t\tcloneBlock( {\n\t\t\t\t\t\t\t\t...topParentListBlock,\n\t\t\t\t\t\t\t\tinnerBlocks: after,\n\t\t\t\t\t\t\t} ),\n\t\t\t\t\t  ]\n\t\t\t\t\t: [];\n\t\t\t\treplaceBlocks(\n\t\t\t\t\ttopParentListBlock.clientId,\n\t\t\t\t\t[ head, middle, ...tail ],\n\t\t\t\t\t1\n\t\t\t\t);\n\t\t\t\t// We manually change the selection here because we are replacing\n\t\t\t\t// a different block than the selected one.\n\t\t\t\tselectionChange( middle.clientId );\n\t\t\t}\n\n\t\t\telement.addEventListener( 'keydown', onKeyDown );\n\t\t\treturn () => {\n\t\t\t\telement.removeEventListener( 'keydown', onKeyDown );\n\t\t\t};\n\t\t},\n\t\t[ canOutdent ]\n\t);\n}\n"]}