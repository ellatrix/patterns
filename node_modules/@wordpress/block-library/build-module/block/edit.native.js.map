{"version":3,"sources":["@wordpress/block-library/src/block/edit.native.js"],"names":["ActivityIndicator","Platform","Text","TouchableWithoutFeedback","View","useState","useCallback","useEntityBlockEditor","useEntityProp","store","coreStore","BottomSheet","Icon","Disabled","TextControl","useSelect","useDispatch","__","sprintf","__experimentalRecursionProvider","RecursionProvider","__experimentalUseHasRecursion","useHasRecursion","InnerBlocks","Warning","blockEditorStore","usePreferredColorSchemeStyle","help","reusableBlocksStore","noticesStore","styles","EditTitle","ReusableBlockEdit","attributes","ref","clientId","isSelected","hasAlreadyRendered","showHelp","setShowHelp","infoTextStyle","infoText","infoTextDark","infoTitleStyle","infoTitle","infoTitleDark","infoSheetIconStyle","infoSheetIcon","infoSheetIconDark","infoDescriptionStyle","infoDescription","infoDescriptionDark","actionButtonStyle","actionButton","actionButtonDark","spinnerStyle","spinner","spinnerDark","hasResolved","isEditing","isMissing","innerBlockCount","select","persistedBlock","getEntityRecord","hasResolvedBlock","hasFinishedResolution","getBlockCount","__experimentalIsEditingReusableBlock","createSuccessNotice","__experimentalConvertBlockToStatic","convertBlockToStatic","clearSelectedBlock","blocks","onInput","onChange","id","title","openSheet","closeSheet","onConvertToRegularBlocks","successNotice","setImmediate","renderSheet","OS","infoContainer","color","size","element"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tActivityIndicator,\n\tPlatform,\n\tText,\n\tTouchableWithoutFeedback,\n\tView,\n} from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { useState, useCallback } from '@wordpress/element';\nimport {\n\tuseEntityBlockEditor,\n\tuseEntityProp,\n\tstore as coreStore,\n} from '@wordpress/core-data';\nimport {\n\tBottomSheet,\n\tIcon,\n\tDisabled,\n\tTextControl,\n} from '@wordpress/components';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { __, sprintf } from '@wordpress/i18n';\nimport {\n\t__experimentalRecursionProvider as RecursionProvider,\n\t__experimentalUseHasRecursion as useHasRecursion,\n\tInnerBlocks,\n\tWarning,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { usePreferredColorSchemeStyle } from '@wordpress/compose';\nimport { help } from '@wordpress/icons';\nimport { store as reusableBlocksStore } from '@wordpress/reusable-blocks';\nimport { store as noticesStore } from '@wordpress/notices';\n\n/**\n * Internal dependencies\n */\nimport styles from './editor.scss';\nimport EditTitle from './edit-title';\n\nexport default function ReusableBlockEdit( {\n\tattributes: { ref },\n\tclientId,\n\tisSelected,\n} ) {\n\tconst hasAlreadyRendered = useHasRecursion( ref );\n\n\tconst [ showHelp, setShowHelp ] = useState( false );\n\tconst infoTextStyle = usePreferredColorSchemeStyle(\n\t\tstyles.infoText,\n\t\tstyles.infoTextDark\n\t);\n\tconst infoTitleStyle = usePreferredColorSchemeStyle(\n\t\tstyles.infoTitle,\n\t\tstyles.infoTitleDark\n\t);\n\tconst infoSheetIconStyle = usePreferredColorSchemeStyle(\n\t\tstyles.infoSheetIcon,\n\t\tstyles.infoSheetIconDark\n\t);\n\tconst infoDescriptionStyle = usePreferredColorSchemeStyle(\n\t\tstyles.infoDescription,\n\t\tstyles.infoDescriptionDark\n\t);\n\tconst actionButtonStyle = usePreferredColorSchemeStyle(\n\t\tstyles.actionButton,\n\t\tstyles.actionButtonDark\n\t);\n\tconst spinnerStyle = usePreferredColorSchemeStyle(\n\t\tstyles.spinner,\n\t\tstyles.spinnerDark\n\t);\n\n\tconst { hasResolved, isEditing, isMissing, innerBlockCount } = useSelect(\n\t\t( select ) => {\n\t\t\tconst persistedBlock = select( coreStore ).getEntityRecord(\n\t\t\t\t'postType',\n\t\t\t\t'wp_block',\n\t\t\t\tref\n\t\t\t);\n\t\t\tconst hasResolvedBlock = select( coreStore ).hasFinishedResolution(\n\t\t\t\t'getEntityRecord',\n\t\t\t\t[ 'postType', 'wp_block', ref ]\n\t\t\t);\n\n\t\t\tconst { getBlockCount } = select( blockEditorStore );\n\n\t\t\treturn {\n\t\t\t\thasResolved: hasResolvedBlock,\n\t\t\t\tisEditing:\n\t\t\t\t\tselect(\n\t\t\t\t\t\treusableBlocksStore\n\t\t\t\t\t).__experimentalIsEditingReusableBlock( clientId ),\n\t\t\t\tisMissing: hasResolvedBlock && ! persistedBlock,\n\t\t\t\tinnerBlockCount: getBlockCount( clientId ),\n\t\t\t};\n\t\t},\n\t\t[ ref, clientId ]\n\t);\n\n\tconst { createSuccessNotice } = useDispatch( noticesStore );\n\tconst { __experimentalConvertBlockToStatic: convertBlockToStatic } =\n\t\tuseDispatch( reusableBlocksStore );\n\tconst { clearSelectedBlock } = useDispatch( blockEditorStore );\n\n\tconst [ blocks, onInput, onChange ] = useEntityBlockEditor(\n\t\t'postType',\n\t\t'wp_block',\n\t\t{ id: ref }\n\t);\n\n\tconst [ title ] = useEntityProp( 'postType', 'wp_block', 'title', ref );\n\n\tfunction openSheet() {\n\t\tsetShowHelp( true );\n\t}\n\n\tfunction closeSheet() {\n\t\tsetShowHelp( false );\n\t}\n\n\tconst onConvertToRegularBlocks = useCallback( () => {\n\t\tconst successNotice =\n\t\t\tinnerBlockCount > 1\n\t\t\t\t? /* translators: %s: name of the reusable block */\n\t\t\t\t  __( '%s converted to regular blocks' )\n\t\t\t\t: /* translators: %s: name of the reusable block */\n\t\t\t\t  __( '%s converted to regular block' );\n\t\tcreateSuccessNotice( sprintf( successNotice, title ) );\n\n\t\tclearSelectedBlock();\n\t\t// Convert action is executed at the end of the current JavaScript execution block\n\t\t// to prevent issues related to undo/redo actions.\n\t\tsetImmediate( () => convertBlockToStatic( clientId ) );\n\t}, [ title, clientId ] );\n\n\tfunction renderSheet() {\n\t\tconst infoTitle =\n\t\t\tPlatform.OS === 'android'\n\t\t\t\t? __(\n\t\t\t\t\t\t'Editing reusable blocks is not yet supported on WordPress for Android'\n\t\t\t\t  )\n\t\t\t\t: __(\n\t\t\t\t\t\t'Editing reusable blocks is not yet supported on WordPress for iOS'\n\t\t\t\t  );\n\n\t\treturn (\n\t\t\t<BottomSheet\n\t\t\t\tisVisible={ showHelp }\n\t\t\t\thideHeader\n\t\t\t\tonClose={ closeSheet }\n\t\t\t>\n\t\t\t\t<View style={ styles.infoContainer }>\n\t\t\t\t\t<Icon\n\t\t\t\t\t\ticon={ help }\n\t\t\t\t\t\tcolor={ infoSheetIconStyle.color }\n\t\t\t\t\t\tsize={ styles.infoSheetIcon.size }\n\t\t\t\t\t/>\n\t\t\t\t\t<Text style={ [ infoTextStyle, infoTitleStyle ] }>\n\t\t\t\t\t\t{ infoTitle }\n\t\t\t\t\t</Text>\n\t\t\t\t\t<Text style={ [ infoTextStyle, infoDescriptionStyle ] }>\n\t\t\t\t\t\t{ innerBlockCount > 1\n\t\t\t\t\t\t\t? __(\n\t\t\t\t\t\t\t\t\t'Alternatively, you can detach and edit these blocks separately by tapping “Convert to regular blocks”.'\n\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t: __(\n\t\t\t\t\t\t\t\t\t'Alternatively, you can detach and edit this block separately by tapping “Convert to regular block”.'\n\t\t\t\t\t\t\t  ) }\n\t\t\t\t\t</Text>\n\t\t\t\t\t<TextControl\n\t\t\t\t\t\tlabel={\n\t\t\t\t\t\t\tinnerBlockCount > 1\n\t\t\t\t\t\t\t\t? __( 'Convert to regular blocks' )\n\t\t\t\t\t\t\t\t: __( 'Convert to regular block' )\n\t\t\t\t\t\t}\n\t\t\t\t\t\tseparatorType=\"topFullWidth\"\n\t\t\t\t\t\tonPress={ onConvertToRegularBlocks }\n\t\t\t\t\t\tlabelStyle={ actionButtonStyle }\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t</BottomSheet>\n\t\t);\n\t}\n\n\tif ( hasAlreadyRendered ) {\n\t\treturn (\n\t\t\t<Warning\n\t\t\t\tmessage={ __( 'Block cannot be rendered inside itself.' ) }\n\t\t\t/>\n\t\t);\n\t}\n\n\tif ( isMissing ) {\n\t\treturn (\n\t\t\t<Warning\n\t\t\t\tmessage={ __( 'Block has been deleted or is unavailable.' ) }\n\t\t\t/>\n\t\t);\n\t}\n\n\tif ( ! hasResolved ) {\n\t\treturn (\n\t\t\t<View style={ spinnerStyle }>\n\t\t\t\t<ActivityIndicator animating />\n\t\t\t</View>\n\t\t);\n\t}\n\n\tlet element = (\n\t\t<InnerBlocks\n\t\t\tvalue={ blocks }\n\t\t\tonChange={ onChange }\n\t\t\tonInput={ onInput }\n\t\t/>\n\t);\n\n\tif ( ! isEditing ) {\n\t\telement = <Disabled>{ element }</Disabled>;\n\t}\n\n\treturn (\n\t\t<RecursionProvider uniqueId={ ref }>\n\t\t\t<TouchableWithoutFeedback\n\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\taccessibilityLabel={ __( 'Help button' ) }\n\t\t\t\taccessibilityRole={ 'button' }\n\t\t\t\taccessibilityHint={ __( 'Tap here to show help' ) }\n\t\t\t\tonPress={ openSheet }\n\t\t\t>\n\t\t\t\t<View>\n\t\t\t\t\t{ isSelected && <EditTitle title={ title } /> }\n\t\t\t\t\t{ element }\n\t\t\t\t\t{ renderSheet() }\n\t\t\t\t</View>\n\t\t\t</TouchableWithoutFeedback>\n\t\t</RecursionProvider>\n\t);\n}\n"]}