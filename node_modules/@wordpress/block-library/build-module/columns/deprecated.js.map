{"version":3,"sources":["@wordpress/block-library/src/columns/deprecated.js"],"names":["classnames","createBlock","InnerBlocks","getColorClassName","getDeprecatedLayoutColumn","originalContent","doc","document","implementation","createHTMLDocument","columnMatch","body","innerHTML","classListItem","firstChild","classList","match","Number","migrateCustomColors","attributes","customTextColor","customBackgroundColor","style","color","text","background","restAttributes","isStackedOnMobile","verticalAlignment","type","backgroundColor","textColor","migrate","save","backgroundClass","textClass","className","undefined","columns","default","isEligible","innerBlocks","isFastPassEligible","some","innerBlock","test","reduce","accumulator","columnIndex","push","migratedInnerBlocks","map","columnBlocks","ignoredColumns","wrapperClasses"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { createBlock } from '@wordpress/blocks';\nimport { InnerBlocks, getColorClassName } from '@wordpress/block-editor';\n\n/**\n * Given an HTML string for a deprecated columns inner block, returns the\n * column index to which the migrated inner block should be assigned. Returns\n * undefined if the inner block was not assigned to a column.\n *\n * @param {string} originalContent Deprecated Columns inner block HTML.\n *\n * @return {number | undefined} Column to which inner block is to be assigned.\n */\nfunction getDeprecatedLayoutColumn( originalContent ) {\n\tlet { doc } = getDeprecatedLayoutColumn;\n\tif ( ! doc ) {\n\t\tdoc = document.implementation.createHTMLDocument( '' );\n\t\tgetDeprecatedLayoutColumn.doc = doc;\n\t}\n\n\tlet columnMatch;\n\n\tdoc.body.innerHTML = originalContent;\n\tfor ( const classListItem of doc.body.firstChild.classList ) {\n\t\tif (\n\t\t\t( columnMatch = classListItem.match( /^layout-column-(\\d+)$/ ) )\n\t\t) {\n\t\t\treturn Number( columnMatch[ 1 ] ) - 1;\n\t\t}\n\t}\n}\n\nconst migrateCustomColors = ( attributes ) => {\n\tif ( ! attributes.customTextColor && ! attributes.customBackgroundColor ) {\n\t\treturn attributes;\n\t}\n\tconst style = { color: {} };\n\tif ( attributes.customTextColor ) {\n\t\tstyle.color.text = attributes.customTextColor;\n\t}\n\tif ( attributes.customBackgroundColor ) {\n\t\tstyle.color.background = attributes.customBackgroundColor;\n\t}\n\n\tconst { customTextColor, customBackgroundColor, ...restAttributes } =\n\t\tattributes;\n\n\treturn {\n\t\t...restAttributes,\n\t\tstyle,\n\t\tisStackedOnMobile: true,\n\t};\n};\n\nexport default [\n\t{\n\t\tattributes: {\n\t\t\tverticalAlignment: {\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t\tbackgroundColor: {\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t\tcustomBackgroundColor: {\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t\tcustomTextColor: {\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t\ttextColor: {\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t},\n\t\tmigrate: migrateCustomColors,\n\t\tsave( { attributes } ) {\n\t\t\tconst {\n\t\t\t\tverticalAlignment,\n\t\t\t\tbackgroundColor,\n\t\t\t\tcustomBackgroundColor,\n\t\t\t\ttextColor,\n\t\t\t\tcustomTextColor,\n\t\t\t} = attributes;\n\n\t\t\tconst backgroundClass = getColorClassName(\n\t\t\t\t'background-color',\n\t\t\t\tbackgroundColor\n\t\t\t);\n\n\t\t\tconst textClass = getColorClassName( 'color', textColor );\n\n\t\t\tconst className = classnames( {\n\t\t\t\t'has-background': backgroundColor || customBackgroundColor,\n\t\t\t\t'has-text-color': textColor || customTextColor,\n\t\t\t\t[ backgroundClass ]: backgroundClass,\n\t\t\t\t[ textClass ]: textClass,\n\t\t\t\t[ `are-vertically-aligned-${ verticalAlignment }` ]:\n\t\t\t\t\tverticalAlignment,\n\t\t\t} );\n\n\t\t\tconst style = {\n\t\t\t\tbackgroundColor: backgroundClass\n\t\t\t\t\t? undefined\n\t\t\t\t\t: customBackgroundColor,\n\t\t\t\tcolor: textClass ? undefined : customTextColor,\n\t\t\t};\n\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tclassName={ className ? className : undefined }\n\t\t\t\t\tstyle={ style }\n\t\t\t\t>\n\t\t\t\t\t<InnerBlocks.Content />\n\t\t\t\t</div>\n\t\t\t);\n\t\t},\n\t},\n\t{\n\t\tattributes: {\n\t\t\tcolumns: {\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 2,\n\t\t\t},\n\t\t},\n\t\tisEligible( attributes, innerBlocks ) {\n\t\t\t// Since isEligible is called on every valid instance of the\n\t\t\t// Columns block and a deprecation is the unlikely case due to\n\t\t\t// its subsequent migration, optimize for the `false` condition\n\t\t\t// by performing a naive, inaccurate pass at inner blocks.\n\t\t\tconst isFastPassEligible = innerBlocks.some( ( innerBlock ) =>\n\t\t\t\t/layout-column-\\d+/.test( innerBlock.originalContent )\n\t\t\t);\n\n\t\t\tif ( ! isFastPassEligible ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Only if the fast pass is considered eligible is the more\n\t\t\t// accurate, durable, slower condition performed.\n\t\t\treturn innerBlocks.some(\n\t\t\t\t( innerBlock ) =>\n\t\t\t\t\tgetDeprecatedLayoutColumn( innerBlock.originalContent ) !==\n\t\t\t\t\tundefined\n\t\t\t);\n\t\t},\n\t\tmigrate( attributes, innerBlocks ) {\n\t\t\tconst columns = innerBlocks.reduce( ( accumulator, innerBlock ) => {\n\t\t\t\tconst { originalContent } = innerBlock;\n\n\t\t\t\tlet columnIndex = getDeprecatedLayoutColumn( originalContent );\n\t\t\t\tif ( columnIndex === undefined ) {\n\t\t\t\t\tcolumnIndex = 0;\n\t\t\t\t}\n\n\t\t\t\tif ( ! accumulator[ columnIndex ] ) {\n\t\t\t\t\taccumulator[ columnIndex ] = [];\n\t\t\t\t}\n\n\t\t\t\taccumulator[ columnIndex ].push( innerBlock );\n\n\t\t\t\treturn accumulator;\n\t\t\t}, [] );\n\n\t\t\tconst migratedInnerBlocks = columns.map( ( columnBlocks ) =>\n\t\t\t\tcreateBlock( 'core/column', {}, columnBlocks )\n\t\t\t);\n\n\t\t\tconst { columns: ignoredColumns, ...restAttributes } = attributes;\n\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\t...restAttributes,\n\t\t\t\t\tisStackedOnMobile: true,\n\t\t\t\t},\n\t\t\t\tmigratedInnerBlocks,\n\t\t\t];\n\t\t},\n\t\tsave( { attributes } ) {\n\t\t\tconst { columns } = attributes;\n\n\t\t\treturn (\n\t\t\t\t<div className={ `has-${ columns }-columns` }>\n\t\t\t\t\t<InnerBlocks.Content />\n\t\t\t\t</div>\n\t\t\t);\n\t\t},\n\t},\n\t{\n\t\tattributes: {\n\t\t\tcolumns: {\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 2,\n\t\t\t},\n\t\t},\n\t\tmigrate( attributes, innerBlocks ) {\n\t\t\tconst { columns, ...restAttributes } = attributes;\n\t\t\tattributes = {\n\t\t\t\t...restAttributes,\n\t\t\t\tisStackedOnMobile: true,\n\t\t\t};\n\n\t\t\treturn [ attributes, innerBlocks ];\n\t\t},\n\t\tsave( { attributes } ) {\n\t\t\tconst { verticalAlignment, columns } = attributes;\n\n\t\t\tconst wrapperClasses = classnames( `has-${ columns }-columns`, {\n\t\t\t\t[ `are-vertically-aligned-${ verticalAlignment }` ]:\n\t\t\t\t\tverticalAlignment,\n\t\t\t} );\n\n\t\t\treturn (\n\t\t\t\t<div className={ wrapperClasses }>\n\t\t\t\t\t<InnerBlocks.Content />\n\t\t\t\t</div>\n\t\t\t);\n\t\t},\n\t},\n];\n"]}