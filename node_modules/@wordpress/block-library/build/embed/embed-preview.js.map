{"version":3,"sources":["@wordpress/block-library/src/embed/embed-preview.js"],"names":["EmbedPreview","Component","constructor","arguments","hideOverlay","bind","state","interactive","getDerivedStateFromProps","nextProps","isSelected","setState","render","preview","previewable","url","type","caption","onCaptionChange","className","icon","label","insertBlocksAfter","props","scripts","html","parsedHost","URL","host","split","parsedHostBaseUrl","splice","length","join","iframeTitle","sandboxClassnames","embedWrapper","RichText","isEmpty"],"mappings":"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","sourcesContent":["/**\n * Internal dependencies\n */\nimport { getPhotoHtml } from './util';\n\n/**\n * External dependencies\n */\nimport classnames from 'classnames/dedupe';\n\n/**\n * WordPress dependencies\n */\nimport { __, sprintf } from '@wordpress/i18n';\nimport { Placeholder, SandBox } from '@wordpress/components';\nimport {\n\tRichText,\n\tBlockIcon,\n\t__experimentalGetElementClassName,\n} from '@wordpress/block-editor';\nimport { Component } from '@wordpress/element';\nimport { createBlock, getDefaultBlockName } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport WpEmbedPreview from './wp-embed-preview';\n\nclass EmbedPreview extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.hideOverlay = this.hideOverlay.bind( this );\n\t\tthis.state = {\n\t\t\tinteractive: false,\n\t\t};\n\t}\n\n\tstatic getDerivedStateFromProps( nextProps, state ) {\n\t\tif ( ! nextProps.isSelected && state.interactive ) {\n\t\t\t// We only want to change this when the block is not selected, because changing it when\n\t\t\t// the block becomes selected makes the overlap disappear too early. Hiding the overlay\n\t\t\t// happens on mouseup when the overlay is clicked.\n\t\t\treturn { interactive: false };\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thideOverlay() {\n\t\t// This is called onMouseUp on the overlay. We can't respond to the `isSelected` prop\n\t\t// changing, because that happens on mouse down, and the overlay immediately disappears,\n\t\t// and the mouse event can end up in the preview content. We can't use onClick on\n\t\t// the overlay to hide it either, because then the editor misses the mouseup event, and\n\t\t// thinks we're multi-selecting blocks.\n\t\tthis.setState( { interactive: true } );\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tpreview,\n\t\t\tpreviewable,\n\t\t\turl,\n\t\t\ttype,\n\t\t\tcaption,\n\t\t\tonCaptionChange,\n\t\t\tisSelected,\n\t\t\tclassName,\n\t\t\ticon,\n\t\t\tlabel,\n\t\t\tinsertBlocksAfter,\n\t\t} = this.props;\n\t\tconst { scripts } = preview;\n\t\tconst { interactive } = this.state;\n\n\t\tconst html = 'photo' === type ? getPhotoHtml( preview ) : preview.html;\n\t\tconst parsedHost = new URL( url ).host.split( '.' );\n\t\tconst parsedHostBaseUrl = parsedHost\n\t\t\t.splice( parsedHost.length - 2, parsedHost.length - 1 )\n\t\t\t.join( '.' );\n\t\tconst iframeTitle = sprintf(\n\t\t\t// translators: %s: host providing embed content e.g: www.youtube.com\n\t\t\t__( 'Embedded content from %s' ),\n\t\t\tparsedHostBaseUrl\n\t\t);\n\t\tconst sandboxClassnames = classnames(\n\t\t\ttype,\n\t\t\tclassName,\n\t\t\t'wp-block-embed__wrapper'\n\t\t);\n\n\t\t// Disabled because the overlay div doesn't actually have a role or functionality\n\t\t// as far as the user is concerned. We're just catching the first click so that\n\t\t// the block can be selected without interacting with the embed preview that the overlay covers.\n\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\t\tconst embedWrapper =\n\t\t\t'wp-embed' === type ? (\n\t\t\t\t<WpEmbedPreview html={ html } />\n\t\t\t) : (\n\t\t\t\t<div className=\"wp-block-embed__wrapper\">\n\t\t\t\t\t<SandBox\n\t\t\t\t\t\thtml={ html }\n\t\t\t\t\t\tscripts={ scripts }\n\t\t\t\t\t\ttitle={ iframeTitle }\n\t\t\t\t\t\ttype={ sandboxClassnames }\n\t\t\t\t\t\tonFocus={ this.hideOverlay }\n\t\t\t\t\t/>\n\t\t\t\t\t{ ! interactive && (\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"block-library-embed__interactive-overlay\"\n\t\t\t\t\t\t\tonMouseUp={ this.hideOverlay }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t);\n\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n\n\t\treturn (\n\t\t\t<figure\n\t\t\t\tclassName={ classnames( className, 'wp-block-embed', {\n\t\t\t\t\t'is-type-video': 'video' === type,\n\t\t\t\t} ) }\n\t\t\t>\n\t\t\t\t{ previewable ? (\n\t\t\t\t\tembedWrapper\n\t\t\t\t) : (\n\t\t\t\t\t<Placeholder\n\t\t\t\t\t\ticon={ <BlockIcon icon={ icon } showColors /> }\n\t\t\t\t\t\tlabel={ label }\n\t\t\t\t\t>\n\t\t\t\t\t\t<p className=\"components-placeholder__error\">\n\t\t\t\t\t\t\t<a href={ url }>{ url }</a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p className=\"components-placeholder__error\">\n\t\t\t\t\t\t\t{ sprintf(\n\t\t\t\t\t\t\t\t/* translators: %s: host providing embed content e.g: www.youtube.com */\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"Embedded content from %s can't be previewed in the editor.\"\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tparsedHostBaseUrl\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</Placeholder>\n\t\t\t\t) }\n\t\t\t\t{ ( ! RichText.isEmpty( caption ) || isSelected ) && (\n\t\t\t\t\t<RichText\n\t\t\t\t\t\tidentifier=\"caption\"\n\t\t\t\t\t\ttagName=\"figcaption\"\n\t\t\t\t\t\tclassName={ __experimentalGetElementClassName(\n\t\t\t\t\t\t\t'caption'\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tplaceholder={ __( 'Add caption' ) }\n\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\tonChange={ onCaptionChange }\n\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t\t__unstableOnSplitAtEnd={ () =>\n\t\t\t\t\t\t\tinsertBlocksAfter(\n\t\t\t\t\t\t\t\tcreateBlock( getDefaultBlockName() )\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</figure>\n\t\t);\n\t}\n}\n\nexport default EmbedPreview;\n"]}