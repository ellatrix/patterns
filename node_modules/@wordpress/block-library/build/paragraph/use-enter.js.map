{"version":3,"sources":["@wordpress/block-library/src/paragraph/use-enter.js"],"names":["useOnEnter","props","batch","moveBlocksToPosition","replaceInnerBlocks","duplicateBlocks","insertBlock","blockEditorStore","getBlockRootClientId","getBlockIndex","getBlockOrder","getBlockName","getBlock","getNextBlockClientId","propsRef","current","element","onKeyDown","event","defaultPrevented","keyCode","ENTER","content","clientId","length","wrapperClientId","order","preventDefault","position","indexOf","wrapperBlock","blockIndex","innerBlocks","slice","addEventListener","removeEventListener"],"mappings":";;;;;;;AAGA;;AACA;;AACA;;AACA;;AACA;;AACA;;AARA;AACA;AACA;AAQO,SAASA,UAAT,CAAqBC,KAArB,EAA6B;AACnC,QAAM;AAAEC,IAAAA;AAAF,MAAY,wBAAlB;AACA,QAAM;AACLC,IAAAA,oBADK;AAELC,IAAAA,kBAFK;AAGLC,IAAAA,eAHK;AAILC,IAAAA;AAJK,MAKF,uBAAaC,kBAAb,CALJ;AAMA,QAAM;AACLC,IAAAA,oBADK;AAELC,IAAAA,aAFK;AAGLC,IAAAA,aAHK;AAILC,IAAAA,YAJK;AAKLC,IAAAA,QALK;AAMLC,IAAAA;AANK,MAOF,qBAAWN,kBAAX,CAPJ;AAQA,QAAMO,QAAQ,GAAG,qBAAQb,KAAR,CAAjB;AACAa,EAAAA,QAAQ,CAACC,OAAT,GAAmBd,KAAnB;AACA,SAAO,2BAAgBe,OAAF,IAAe;AACnC,aAASC,SAAT,CAAoBC,KAApB,EAA4B;AAC3B,UAAKA,KAAK,CAACC,gBAAX,EAA8B;AAC7B;AACA;;AAED,UAAKD,KAAK,CAACE,OAAN,KAAkBC,eAAvB,EAA+B;AAC9B;AACA;;AAED,YAAM;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,UAAwBT,QAAQ,CAACC,OAAvC,CAT2B,CAW3B;;AACA,UAAKO,OAAO,CAACE,MAAb,EAAsB;AACrB;AACA;;AAED,YAAMC,eAAe,GAAGjB,oBAAoB,CAAEe,QAAF,CAA5C;;AAEA,UACC,CAAE,6BACDZ,YAAY,CAAEc,eAAF,CADX,EAED,uBAFC,EAGD,KAHC,CADH,EAME;AACD;AACA;;AAED,YAAMC,KAAK,GAAGhB,aAAa,CAAEe,eAAF,CAA3B;AAEAP,MAAAA,KAAK,CAACS,cAAN;AAEA,YAAMC,QAAQ,GAAGF,KAAK,CAACG,OAAN,CAAeN,QAAf,CAAjB,CAhC2B,CAkC3B;;AACA,UAAKK,QAAQ,KAAKF,KAAK,CAACF,MAAN,GAAe,CAAjC,EAAqC;AACpCrB,QAAAA,oBAAoB,CACnB,CAAEoB,QAAF,CADmB,EAEnBE,eAFmB,EAGnBjB,oBAAoB,CAAEiB,eAAF,CAHD,EAInBhB,aAAa,CAAEgB,eAAF,CAAb,GAAmC,CAJhB,CAApB;AAMA;AACA,OA3C0B,CA6C3B;;;AACA,YAAMK,YAAY,GAAGlB,QAAQ,CAAEa,eAAF,CAA7B;AACAvB,MAAAA,KAAK,CAAE,MAAM;AACZG,QAAAA,eAAe,CAAE,CAAEoB,eAAF,CAAF,CAAf;AACA,cAAMM,UAAU,GAAGtB,aAAa,CAAEgB,eAAF,CAAhC;AAEArB,QAAAA,kBAAkB,CACjBqB,eADiB,EAEjBK,YAAY,CAACE,WAAb,CAAyBC,KAAzB,CAAgC,CAAhC,EAAmCL,QAAnC,CAFiB,CAAlB;AAIAxB,QAAAA,kBAAkB,CACjBS,oBAAoB,CAAEY,eAAF,CADH,EAEjBK,YAAY,CAACE,WAAb,CAAyBC,KAAzB,CAAgCL,QAAQ,GAAG,CAA3C,CAFiB,CAAlB;AAIAtB,QAAAA,WAAW,CACV,yBAAa,gBAAb,CADU,EAEVyB,UAAU,GAAG,CAFH,EAGVvB,oBAAoB,CAAEiB,eAAF,CAHV,EAIV,IAJU,CAAX;AAMA,OAlBI,CAAL;AAmBA;;AAEDT,IAAAA,OAAO,CAACkB,gBAAR,CAA0B,SAA1B,EAAqCjB,SAArC;AACA,WAAO,MAAM;AACZD,MAAAA,OAAO,CAACmB,mBAAR,CAA6B,SAA7B,EAAwClB,SAAxC;AACA,KAFD;AAGA,GAzEM,EAyEJ,EAzEI,CAAP;AA0EA","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\nimport { ENTER } from '@wordpress/keycodes';\nimport { useSelect, useDispatch, useRegistry } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { hasBlockSupport, createBlock } from '@wordpress/blocks';\n\nexport function useOnEnter( props ) {\n\tconst { batch } = useRegistry();\n\tconst {\n\t\tmoveBlocksToPosition,\n\t\treplaceInnerBlocks,\n\t\tduplicateBlocks,\n\t\tinsertBlock,\n\t} = useDispatch( blockEditorStore );\n\tconst {\n\t\tgetBlockRootClientId,\n\t\tgetBlockIndex,\n\t\tgetBlockOrder,\n\t\tgetBlockName,\n\t\tgetBlock,\n\t\tgetNextBlockClientId,\n\t} = useSelect( blockEditorStore );\n\tconst propsRef = useRef( props );\n\tpropsRef.current = props;\n\treturn useRefEffect( ( element ) => {\n\t\tfunction onKeyDown( event ) {\n\t\t\tif ( event.defaultPrevented ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( event.keyCode !== ENTER ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { content, clientId } = propsRef.current;\n\n\t\t\t// The paragraph should be empty.\n\t\t\tif ( content.length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst wrapperClientId = getBlockRootClientId( clientId );\n\n\t\t\tif (\n\t\t\t\t! hasBlockSupport(\n\t\t\t\t\tgetBlockName( wrapperClientId ),\n\t\t\t\t\t'__experimentalOnEnter',\n\t\t\t\t\tfalse\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst order = getBlockOrder( wrapperClientId );\n\n\t\t\tevent.preventDefault();\n\n\t\t\tconst position = order.indexOf( clientId );\n\n\t\t\t// If it is the last block, exit.\n\t\t\tif ( position === order.length - 1 ) {\n\t\t\t\tmoveBlocksToPosition(\n\t\t\t\t\t[ clientId ],\n\t\t\t\t\twrapperClientId,\n\t\t\t\t\tgetBlockRootClientId( wrapperClientId ),\n\t\t\t\t\tgetBlockIndex( wrapperClientId ) + 1\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If it is in the middle, split the block in two.\n\t\t\tconst wrapperBlock = getBlock( wrapperClientId );\n\t\t\tbatch( () => {\n\t\t\t\tduplicateBlocks( [ wrapperClientId ] );\n\t\t\t\tconst blockIndex = getBlockIndex( wrapperClientId );\n\n\t\t\t\treplaceInnerBlocks(\n\t\t\t\t\twrapperClientId,\n\t\t\t\t\twrapperBlock.innerBlocks.slice( 0, position )\n\t\t\t\t);\n\t\t\t\treplaceInnerBlocks(\n\t\t\t\t\tgetNextBlockClientId( wrapperClientId ),\n\t\t\t\t\twrapperBlock.innerBlocks.slice( position + 1 )\n\t\t\t\t);\n\t\t\t\tinsertBlock(\n\t\t\t\t\tcreateBlock( 'core/paragraph' ),\n\t\t\t\t\tblockIndex + 1,\n\t\t\t\t\tgetBlockRootClientId( wrapperClientId ),\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t} );\n\t\t}\n\n\t\telement.addEventListener( 'keydown', onKeyDown );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'keydown', onKeyDown );\n\t\t};\n\t}, [] );\n}\n"]}